<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Class Animes ‚Äî Estrelas</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body {
      background: #0b0b0b;
      font-family: Inter, system-ui, sans-serif;
      color: #e6e6e6;
      padding-bottom: 100px;
    }

    .menu {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #151515;
      border-top: 1px solid #2a2a2a;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      z-index: 30;
    }

    .menu-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #b3b3b3;
      font-size: 0.75rem;
      transition: all 0.2s;
    }

    .menu-btn:hover,
    .menu-btn.active {
      color: #B9314F;
    }

    .menu-btn svg {
      width: 22px;
      height: 22px;
      margin-bottom: 4px;
    }

    .filter-btn {
      border: 1px solid #3a3a3a;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      white-space: nowrap;
    }

    .filter-btn.active {
      background: #B9314F;
      border-color: #992743;
      color: white;
    }

    .anime-card:hover {
      transform: translateY(-6px);
      transition: .2s;
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    /* Custom scrollbar for filtros */
    #stars-filter::-webkit-scrollbar {
        height: 6px;
        }

        #stars-filter::-webkit-scrollbar-track {
        background: #0d0d0d; /* fundo escuro */
        border-radius: 10px;
        }

        #stars-filter::-webkit-scrollbar-thumb {
        background: #444; /* cinza discreto */
        border-radius: 10px;
        }

        #stars-filter::-webkit-scrollbar-thumb:hover {
        background: #B9314F; /* cor tema ao passar */
        }

  </style>
</head>

<body>

<div id="app" class="container mx-auto max-w-6xl px-4 pt-4">

  <!-- MENU SUPERIOR -->
  <header class="bg-[#1f1f1f] p-2 mb-3 shadow-xl rounded-xl border border-[#2a2a2a]">
    <div class="flex justify-between items-center">
      <button onclick="window.location.href='home.html'"
              class="text-2xl font-bold text-[#B9314F] hover:text-[#992743] transition-colors">
        My Hub
      </button>
      <h1 class="text-2xl font-bold text-white">My Animes</h1>
    </div>

    <div class="text-sm text-gray-300 mt-2">
      Usu√°rio: <span id="user-email" class="text-[#B9314F] font-mono">...</span>
    </div>
  </header>


  <!-- FILTRO ROL√ÅVEL -->
  <section class="overflow-x-auto whitespace-nowrap pb-3 mb-6 flex gap-2" id="stars-filter">
    <!-- Bot√µes criados dinamicamente -->
  </section>


  <!-- GRID DE ANIMES -->
  <main id="anime-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></main>


  <p id="empty-msg" class="text-center text-gray-400 mt-8">
    üëÜ Escolha uma categoria acima!
    </p>

</div>


<!-- MENU INFERIOR -->
<nav class="menu">
    <button class="menu-btn" onclick="abrirPagina('animes_manager.html')">
        <i data-lucide="home"></i>
        <span>In√≠cio</span>
    </button>
    <button class="menu-btn" onclick="abrirPagina('animes_cadastro.html')">
        <i data-lucide="file-edit"></i>
        <span>Gest√£o</span>
    </button>
    <!-- Lista: Agora vis√≠vel em todos os tamanhos de tela. -->
    <button class="menu-btn" onclick="abrirPagina('anime_lista.html')">
        <i data-lucide="list"></i>
        <span>Lista</span>
    </button>

    <!-- Classifica√ß√£o, Estrelas e Torneio est√£o permanentemente ocultos no menu principal,
         e ser√£o acess√≠veis apenas pelo bot√£o 'Mais'. -->
    <button class="menu-btn hidden" onclick="abrirPagina('animes_classificacoes.html')">
        <i data-lucide="bar-chart-2"></i>
        <span>Classifica√ß√£o</span>
    </button>
    <button class="menu-btn hidden" onclick="abrirPagina('animes_estrelas.html')">
        <i data-lucide="star"></i>
        <span>Estrelas</span>
    </button>
    <button class="menu-btn hidden" onclick="abrirPagina('animes_torneio.html')">
        <i data-lucide="trophy"></i>
        <span>Torneio</span>
    </button>

    <!-- Bot√£o de Mais Op√ß√µes (Dropdown) -->
    <!-- Removido 'sm:hidden' para que o bot√£o 'Mais' seja sempre vis√≠vel. -->
    <div class="relative flex">
        <button id="more-options-btn" class="menu-btn active" onclick="toggleMoreOptions(event)">
            <i data-lucide="more-horizontal"></i>
            <span>Mais</span>
        </button>

        <!-- Dropdown de Mais Op√ß√µes -->
        <!-- ADICIONADO: 'flex flex-col' para empilhar os itens verticalmente -->
        <div id="more-options-dropdown"
             class="absolute bottom-full mb-2 right-0 w-40 bg-[#1f1f1f] border border-[#2a2a2a]
                    rounded-lg shadow-xl p-2 hidden z-50 flex flex-col">

            <!-- Lista foi removida daqui, pois agora est√° no menu principal. -->
            <!-- Adicionado 'text-left' para garantir o alinhamento do texto √† esquerda dentro do bot√£o. -->
            <button class="dropdown-item text-left" onclick="abrirPagina('animes_classificacoes.html')">
                <i data-lucide="bar-chart-2" class="w-4 h-4"></i> Classifica√ß√£o
            </button>
            <button class="dropdown-item text-left" onclick="abrirPagina('animes_estrelas.html')">
                <i data-lucide="star" class="w-4 h-4"></i> Estrelas
            </button>
            <button class="dropdown-item text-left" onclick="abrirPagina('animes_torneio.html')">
                <i data-lucide="trophy" class="w-4 h-4"></i> Torneio
            </button>
        </div>
    </div>
</nav>

<script>
  lucide.createIcons();
  function abrirPagina(p) { window.location.href = p }
</script>


<!-- FIREBASE + FILTRO EM MEM√ìRIA -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDsbiLPBOda119Qr6Ji69j8TZLpiFixBWI",
    authDomain: "list-games-9bddd.firebaseapp.com",
    projectId: "list-games-9bddd",
    storageBucket: "list-games-9bddd.firebasestorage.app",
    messagingSenderId: "756898313156",
    appId: "1:756898313156:web:9bc660d0a2f4cd07882a91",
    measurementId: "G-GLM50YVLXP"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const userEmailEl = document.getElementById("user-email");
  const gridEl = document.getElementById("anime-grid");
  const emptyMsg = document.getElementById("empty-msg");
  const starsFilterEl = document.getElementById("stars-filter");

  let allAnimes = [];
  let selectedStars = null; // null = mostrar todos

  const starOptions = [
    { label: "ü•á R1", value: "‚ú∂" },
    { label: "ü•à R2", value: "‚ú∂ ‚ú∂" },
    { label: "ü•â R3", value: "‚ú∂ ‚ú∂ ‚ú∂" },
    { label: "5 ‚≠ê", value: 5 },
    { label: "4 ‚≠ê", value: 4 },
    { label: "3 ‚≠ê", value: 3 },
    { label: "2 ‚≠ê", value: 2 },
    { label: "1 ‚≠ê", value: 1 },
    { label: "0 ‚≠ê", value: 0 },
    { label: "Sem ‚≠ê", value: "" }
    ];


  function toggleMoreOptions(event) {
      event.stopPropagation(); // Previne que o clique feche imediatamente
      const dropdown = document.getElementById('more-options-dropdown');
      dropdown.classList.toggle('hidden');
  }

  // Fun√ß√£o para fechar o dropdown se o usu√°rio clicar fora dele
  document.addEventListener('click', (e) => {
      const dropdown = document.getElementById('more-options-dropdown');
      const button = document.getElementById('more-options-btn');
      if (dropdown && button && !button.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.classList.add('hidden');
      }
  });
  
  window.toggleMoreOptions = toggleMoreOptions;

  function renderStarsFilter() {
    starsFilterEl.innerHTML = starOptions.map(opt => `
      <button class="filter-btn ${selectedStars === opt.value ? "active" : ""}"
              data-value="${opt.value}">
        ${opt.label}
      </button>
    `).join("");

    starsFilterEl.querySelectorAll("button").forEach(btn => {
      btn.onclick = () => {
        let value = btn.dataset.value;

        if (value == "") {
            // SEM AVALIA√á√ÉO
            selectedStars = "";
        }
        else if (["‚ú∂", "‚ú∂ ‚ú∂", "‚ú∂ ‚ú∂ ‚ú∂"].includes(value)) {
            // TIERS ESPECIAIS
            selectedStars = value;
        }
        else {
            // ESTRELAS NUM√âRICAS
            selectedStars = Number(value);
        }

        renderStarsFilter();
        renderGrid();
        };
    });
  }

  function animeCard(anime) {
    return `
        <div class="bg-[#181818] rounded-lg shadow-lg overflow-hidden hover:scale-105 transition-transform duration-200 relative">

        <!-- Badge no topo (Tier ou estrelas) -->
        <div class="absolute top-2 right-2 text-xs px-2 py-1 rounded-md bg-[#B9314F] text-white font-bold">
            ${anime.STARS || "-"}
        </div>

        <!-- Imagem do anime -->
        <img 
            src="${anime.IMAGEM || 'https://via.placeholder.com/300x450?text=Sem+Imagem'}" 
            alt="${anime.NOME}"
            class="w-full object-cover"
            style="aspect-ratio: 2/3;"
        >

        <!-- Conte√∫do do Card -->
        <div class="p-3 text-gray-300 text-sm">
            <h3 class="text-lg font-bold text-white mb-1 truncate">${anime.NOME}</h3>

            <p><span class="font-semibold text-white">Nota:</span> ${Number(anime.NOTA_F).toFixed(2)}</p>
            <p><span class="font-semibold text-white">Nota M.A.L.:</span> ${anime.N_MAL || "-"}</p>
            <p><span class="font-semibold text-white">Estado:</span> ${anime.ESTADO || "-"}</p>
            <p><span class="font-semibold text-white">Estilo:</span> ${anime.ESTILO || "-"}</p>
            <p><span class="font-semibold text-white">Ano:</span> ${anime.ANO || "-"}</p>
            <p><span class="font-semibold text-white">Temporada:</span> ${anime.TEMPORADA || "-"}</p>
        </div>

        </div>
    `;
    }


  function renderGrid() {
    let filtered = [...allAnimes];

    // Tier especial: ‚ú∂, ‚ú∂ ‚ú∂, ‚ú∂ ‚ú∂ ‚ú∂
    if (["‚ú∂", "‚ú∂ ‚ú∂", "‚ú∂ ‚ú∂ ‚ú∂"].includes(selectedStars)) {
        filtered = filtered.filter(a => a.STARS === selectedStars);

    // Sem estrela ("-")
    } else if (selectedStars === "") {
        filtered = filtered.filter(a =>
        a.STARS === "" || a.STARS == null
        );

    // Zero estrela (0)
    } else if (selectedStars === 0) {
        filtered = filtered.filter(a =>
        a.STARS === 0 || a.STARS === "0"
        );

    // Estrelas num√©ricas
    } else if (!isNaN(selectedStars)) {
        filtered = filtered.filter(a =>
        Number(a.STARS) === Number(selectedStars)
        );
    }

    gridEl.innerHTML = filtered.map(animeCard).join("");
    emptyMsg.classList.toggle("hidden", filtered.length > 0);
    }

  async function loadAnimes(userId) {
    const ref = collection(db, "users", userId, "animes");
    const snap = await getDocs(ref);
    allAnimes = snap.docs.map(doc =>
      ({ id: doc.id, ...doc.data() })
    );
    gridEl.innerHTML = "";
    emptyMsg.classList.remove("hidden");
  }

  onAuthStateChanged(auth, user => {
    if (user) {
      userEmailEl.textContent = user.email;
      renderStarsFilter();
      loadAnimes(user.uid);
    }
  });
</script>

</body>
</html>
