<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerenciador de Manhwas — My Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
      /* Configurações Base */
      :root {
          --accent-color: #B9314F;
          --bg-dark: #0b0b0b;
          --bg-panel: #151515;
      }
      body {
          background-color: var(--bg-dark);
          color: #e6e6e6;
          font-family: 'Inter', system-ui, sans-serif;
          /* Gradiente de fundo sutil estilo Xbox */
          background-image: radial-gradient(circle at top right, rgba(185, 49, 79, 0.1), transparent 40%),
                            radial-gradient(circle at bottom left, rgba(20, 20, 20, 1), transparent 40%);
          min-height: 100vh;
      }

      /* Utilitários de Estilo */
      .text-accent { color: var(--accent-color); }
      .bg-accent { background-color: var(--accent-color); }
      
      /* Painéis translúcidos */
      .glass-panel {
          background: rgba(21, 21, 21, 0.8);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* Cards com efeito Xbox */
      .task-card {
          background: rgba(30, 30, 30, 0.4); /* Mais transparente para destacar o desfoque */
          backdrop-filter: blur(12px); /* Efeito de janela fosca (vidro) */
          -webkit-backdrop-filter: blur(12px); /* Suporte para Safari */
          border: 1px solid rgba(255, 255, 255, 0.05); /* Borda sutil reflexiva */
          transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
          box-shadow: 0 8px 16px -4px rgba(0, 0, 0, 0.4);
      }
      .task-card:hover {
          transform: translateY(-4px);
          background: rgba(40, 40, 40, 0.6);
          border-color: rgba(185, 49, 79, 0.3); /* Borda levemente avermelhada ao passar o mouse */
          box-shadow: 0 12px 24px -5px rgba(0, 0, 0, 0.6), 0 0 15px rgba(185, 49, 79, 0.1);
      }

      /* Inputs estilo Xbox */
      input, select, textarea {
          background: rgba(0, 0, 0, 0.4);
          border: 2px solid rgba(255, 255, 255, 0.1);
          transition: all 0.3s;
          color: white;
          color-scheme: dark; /* Força o scrollbar nativo dos campos a ficar escuro */
      }
      input:focus, select:focus, textarea:focus {
          border-color: var(--accent-color);
          box-shadow: 0 0 0 3px rgba(185, 49, 79, 0.1);
          outline: none;
      }

      option {
          background-color: var(--bg-panel); /* Fundo escuro igual ao painel da tela */
          color: #e6e6e6; /* Texto claro */
          padding: 10px;
      }

      /* Botões com efeito Xbox */
      .xbox-button {
          position: relative;
          overflow: hidden;
          transition: all 0.3s;
      }
      .xbox-button::before {
          content: '';
          position: absolute;
          inset: 0;
          background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
          transform: translateX(-100%);
          transition: transform 0.6s;
      }
      .xbox-button:hover::before {
          transform: translateX(100%);
      }
      .xbox-button:hover {
          transform: scale(1.02);
          box-shadow: 0 0 20px rgba(185, 49, 79, 0.4);
      }

      /* Scrollbar customizada */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: var(--bg-dark); }
      ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: var(--accent-color); }

      /* Sidebar retrátil */
      .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          bottom: 0;
          width: 80px;
          transform: translateX(0);
          transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
          z-index: 50;
      }
      .sidebar.hidden {
          transform: translateX(-100%);
      }
      
      /* Ajustar conteúdo quando sidebar está visível */
      .main-content {
          margin-left: 80px;
          transition: margin-left 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      }
      .main-content.sidebar-hidden {
          margin-left: 0;
      }

      /* Botão toggle */
      .toggle-sidebar-btn {
          transition: all 0.3s;
      }
      .toggle-sidebar-btn:hover {
          transform: scale(1.1);
          box-shadow: 0 0 15px rgba(185, 49, 79, 0.4);
      }
  </style>
</head>
<body class="flex h-screen overflow-hidden">

  <!-- OVERLAY DE CARREGAMENTO -->
  <div id="loading" class="fixed inset-0 z- flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="animate-spin h-16 w-16 border-4 border-t-transparent border- rounded-full"></div>
  </div>

  <!-- SIDEBAR RETRÁTIL -->
  <aside id="sidebar" class="sidebar flex flex-col w-20 bg- border-r border-white/10 items-center py-6 flex-shrink-0 glass-panel">
      <div class="text-accent mb-8">
          <i data-lucide="sparkle" class="w-10 h-10"></i>
      </div>
      
      <nav class="flex flex-col gap-3 md:gap-6 items-center flex-1">
          <a href="home.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="Home">
              <i data-lucide="home" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="games_manager.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="Games">
              <i data-lucide="gamepad-2" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="animes_manager.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="Animes">
              <i data-lucide="tv" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="cards_manager.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="Cards">
              <i data-lucide="layers" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="hqs_manager.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="HQs">
              <i data-lucide="book-open-text" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="manga_manager.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="Mangás">
              <i data-lucide="notebook-text" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="#" class="text-accent p-1.5 md:p-2 bg-white/5 rounded-xl" title="Manhwas">
              <i data-lucide="smartphone" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="academia_exercicios.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="Academia">
              <i data-lucide="dumbbell" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>

          <a href="to_do.html" class="text-gray-500 hover:text-gray-200 p-1.5 md:p-2 hover:bg-white/5 rounded-xl transition" title="To Do">
              <i data-lucide="check-square" class="w-5 h-5 md:w-7 md:h-7"></i>
          </a>
      </nav>

      <button id="logout-btn" class="mt-auto text-red-500 hover:text-red-400 p-1.5 md:p-2 hover:bg-red-500/10 rounded-xl transition" title="Sair">
          <i data-lucide="log-out" class="w-5 h-5 md:w-7 md:h-7"></i>
      </button>
  </aside>

  <!-- CONTEÚDO PRINCIPAL -->
  <main id="main-content" class="main-content flex-1 flex flex-col overflow-hidden relative">
      
      <!-- HEADER -->
      <header class="flex justify-between items-center p-6 md:px-8 bg-transparent z-10">
          <div class="flex items-center gap-3">
              <button id="toggle-sidebar" class="toggle-sidebar-btn p-2 bg-white/5 hover:bg-white/10 rounded-xl text-gray-400 hover:text-accent transition" title="Mostrar/Ocultar Menu">
                  <i data-lucide="menu" class="w-5 h-5"></i>
              </button>
              
              <div>
                  <h2 class="text-2xl md:text-3xl font-bold text-white flex items-center gap-3">
                      <i data-lucide="smartphone" class="text-accent"></i> My Manhwas
                  </h2>
              </div>
          </div>
          
          <div class="hidden sm:block text-sm text-gray-400 bg-white/5 px-4 py-2 rounded-xl border border-white/5">
              Usuário: <span id="user-email" class="text-accent font-mono font-bold">...</span>
          </div>
      </header>

      <!-- ÁREA DE CONTEÚDO (Oculta até carregar os dados) -->
      <div id="app" class="flex-1 overflow-y-auto p-6 md:px-8 pb-8 hidden">
          <div class="max-w-6xl mx-auto">
              
              <!-- AÇÕES TOPO -->
              <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
                  <button id="add-btn" class="xbox-button w-full sm:w-auto bg-accent text-white px-6 py-2.5 rounded-xl font-bold flex items-center justify-center gap-2">
                      <i data-lucide="plus-circle" class="w-5 h-5"></i> Novo Manhwa
                  </button>

                  <button id="toggle-filter-btn" class="w-full sm:w-auto bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white px-6 py-2.5 rounded-xl border border-white/10 transition-all font-bold text-sm flex items-center justify-center gap-2">
                      <i data-lucide="filter" class="w-4 h-4"></i> Mostrar Filtros
                  </button>
              </div>

              <!-- PAINEL DE FILTROS -->
              <div id="filter-container" class="glass-panel p-6 rounded-2xl mb-6 hidden">
                  <section class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                      <div>
                          <label class="block text-xs text-gray-500 mb-2 uppercase font-semibold">Pesquisa</label>
                          <input id="search-input" type="text" placeholder="Pesquisar por nome..." class="w-full rounded-xl px-4 py-2.5">
                      </div>
                      <div>
                          <label class="block text-xs text-gray-500 mb-2 uppercase font-semibold">Gênero</label>
                          <select id="filter-genero" class="w-full rounded-xl px-4 py-2.5"></select>
                      </div>
                      <div>
                          <label class="block text-xs text-gray-500 mb-2 uppercase font-semibold">Status</label>
                          <select id="filter-status" class="w-full rounded-xl px-4 py-2.5">
                              <option value="">Todos os status</option>
                              <option value="Lido">Lido</option>
                              <option value="Lendo">Lendo</option>
                              <option value="Quero Ler">Quero Ler</option>
                              <option value="Dropei">Dropei</option>
                          </select>
                      </div>
                      <div>
                          <label class="block text-xs text-gray-500 mb-2 uppercase font-semibold">Avaliação</label>
                          <select id="filter-stars" class="w-full rounded-xl px-4 py-2.5">
                              <option value="">Todas as estrelas</option>
                              <option value="1">1 Estrela</option>
                              <option value="2">2 Estrelas</option>
                              <option value="3">3 Estrelas</option>
                              <option value="4">4 Estrelas</option>
                              <option value="5">5 Estrelas</option>
                          </select>
                      </div>
                  </section>

                  <div class="flex justify-end items-center gap-3 pt-4 border-t border-white/5">
                      <label class="text-sm font-semibold text-gray-400">Ordenar por:</label>
                      <select id="sort-select" class="w-48 rounded-xl px-4 py-2.5 text-sm">
                          <option value="name">Nome</option>
                          <option value="stars">Estrelas</option>
                          <option value="chapters">Capítulos</option>
                          <option value="status">Status</option>
                      </select>
                  </div>
              </div>

              <!-- LISTA DE CARDS -->
              <div id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"></div>
              
              <div id="empty" class="text-center py-16 hidden">
                  <i data-lucide="ghost" class="w-16 h-16 mx-auto mb-4 opacity-20 text-gray-500"></i>
                  <p class="text-lg text-gray-500 font-semibold">Nenhum Manhwa encontrado.</p>
              </div>

          </div>
      </div>
  </main>

  <!-- MODAL ADICIONAR/EDITAR -->
  <div id="modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50 overflow-auto p-4 transition-all">
    <div class="glass-panel rounded-2xl w-full max-w-xl p-6 shadow-2xl relative border border-white/10">
      
      <div class="flex justify-between items-center mb-6">
        <h2 id="modal-title" class="text-xl font-bold text-white flex items-center gap-2">
            <i data-lucide="smartphone" class="w-5 h-5 text-accent"></i> Novo Manhwa
        </h2>
        <button id="close-modal" class="text-gray-500 hover:text-white transition bg-white/5 p-2 rounded-xl hover:bg-white/10">
            <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>

      <form id="manhwa-form" class="space-y-4">
        <input type="hidden" id="manhwa-id">
        
        <div>
          <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Título</label>
          <input id="manhwa-title" type="text" class="w-full rounded-xl px-4 py-3 text-sm" required placeholder="Nome do Manhwa">
        </div>
        
        <div>
          <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">URL da Imagem</label>
          <input id="manhwa-img" type="url" class="w-full rounded-xl px-4 py-3 text-sm" placeholder="https://...">
        </div>
        
        <div>
          <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Gênero</label>
          <input id="manhwa-genero" type="text" class="w-full rounded-xl px-4 py-3 text-sm" placeholder="Ação, Romance, Fantasia...">
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Estrelas</label>
            <select id="manhwa-stars" class="w-full rounded-xl px-4 py-3 text-sm">
              <option value="0">Sem Avaliação</option>
              <option value="1">1 Estrela</option>
              <option value="2">2 Estrelas</option>
              <option value="3">3 Estrelas</option>
              <option value="4">4 Estrelas</option>
              <option value="5">5 Estrelas</option>
            </select>
          </div>
          <div>
            <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Status</label>
            <select id="manhwa-status" class="w-full rounded-xl px-4 py-3 text-sm">
              <option value="Lendo">Lendo</option>
              <option value="Lido">Lido</option>
              <option value="Quero Ler">Quero Ler</option>
              <option value="Dropei">Dropei</option>
            </select>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Capítulos Totais</label>
            <input id="manhwa-total" type="number" min="0" class="w-full rounded-xl px-4 py-3 text-sm" placeholder="Ex: 150">
          </div>
          <div>
            <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Capítulos Lidos</label>
            <input id="manhwa-read" type="number" min="0" class="w-full rounded-xl px-4 py-3 text-sm" placeholder="Ex: 45">
          </div>
        </div>
        
        <div>
          <label class="block text-xs text-gray-500 mb-1.5 uppercase font-semibold">Observações</label>
          <textarea id="manhwa-notes" rows="3" class="w-full rounded-xl px-4 py-3 text-sm resize-none" placeholder="Detalhes, resenhas..."></textarea>
        </div>
        
        <div class="flex items-center gap-3 pt-4 mt-2 border-t border-white/5">
            <button id="delete-btn" type="button" class="px-4 py-3 rounded-xl bg-red-500/10 text-red-500 hover:bg-red-500/20 font-bold transition flex items-center justify-center hidden" title="Excluir">
                <i data-lucide="trash-2" class="w-5 h-5"></i>
            </button>
            <button type="submit" class="xbox-button flex-1 bg-accent text-white px-4 py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                <i data-lucide="save" class="w-5 h-5"></i> Salvar
            </button>
        </div>
      </form>
    </div>
  </div>

  <!-- SCRIPT PARA UI DA SIDEBAR -->
  <script>
      lucide.createIcons();
      
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('main-content');
      const toggleBtn = document.getElementById('toggle-sidebar');
      
      toggleBtn.addEventListener('click', () => {
          sidebar.classList.toggle('hidden');
          mainContent.classList.toggle('sidebar-hidden');
      });
  </script>

  <!-- FIREBASE E LÓGICA -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, query, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDsbiLPBOda119Qr6Ji69j8TZLpiFixBWI",
      authDomain: "list-games-9bddd.firebaseapp.com",
      projectId: "list-games-9bddd",
      storageBucket: "list-games-9bddd.firebasestorage.app",
      messagingSenderId: "756898313156",
      appId: "1:756898313156:web:9bc660d0a2f4cd07882a91",
      measurementId: "G-GLM50YVLXP"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- Seletores de UI ---
    const loading = document.getElementById('loading');
    const appEl = document.getElementById('app');
    const userEmailEl = document.getElementById('user-email');

    const cards = document.getElementById('cards');
    const empty = document.getElementById('empty');
    const modal = document.getElementById('modal');
    const form = document.getElementById('manhwa-form'); 
    const deleteBtn = document.getElementById('delete-btn');
    const closeModal = document.getElementById('close-modal');
    const addBtn = document.getElementById('add-btn');

    const logoutBtn = document.getElementById('logout-btn');
    const searchInput = document.getElementById('search-input');
    const filterGenero = document.getElementById('filter-genero');
    const filterStatus = document.getElementById('filter-status');
    const filterStars = document.getElementById('filter-stars');
    const sortSelect = document.getElementById('sort-select');

    const toggleFilterBtn = document.getElementById('toggle-filter-btn');
    const filterContainer = document.getElementById('filter-container');

    let allMangas =[];
    let currentUser = null;
    let editingId = null;
    let isFirstLoad = true;

    // Autenticação
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = 'index.html';
        return;
      }
      currentUser = user;
      userEmailEl.textContent = user.email || user.uid;

      const q = query(collection(db, 'users', user.uid, 'manhwas'));
      
      onSnapshot(q, (snap) => {
        allMangas =[];
        snap.forEach(doc => allMangas.push({ id: doc.id, ...doc.data() }));
        updateFilters();
        render();

        if (isFirstLoad) {
          loading.classList.add('hidden');
          appEl.classList.remove('hidden');
          isFirstLoad = false;
        }
      }, (error) => {
        console.error("Erro ao buscar Manhwas: ", error);
        if (isFirstLoad) {
          loading.classList.add('hidden');
          appEl.classList.remove('hidden');
          isFirstLoad = false;
        }
        cards.innerHTML = "<p class='text-center text-red-400'>Erro ao carregar dados.</p>";
      });
    });

    // Logout
    logoutBtn.addEventListener('click', async () => {
      await signOut(auth);
      window.location.href = 'index.html';
    });

    // Filtros UI
    toggleFilterBtn.addEventListener('click', () => {
      const isHidden = filterContainer.classList.toggle('hidden');
      if (isHidden) {
        toggleFilterBtn.innerHTML = '<i data-lucide="filter" class="w-4 h-4"></i> Mostrar Filtros';
      } else {
        toggleFilterBtn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Esconder Filtros';
      }
      lucide.createIcons();
    });

    // Abrir Modal Adicionar
    addBtn.addEventListener('click', () => {
      editingId = null;
      form.reset();
      deleteBtn.classList.add('hidden');
      document.getElementById('modal-title').innerHTML = '<i data-lucide="smartphone" class="w-5 h-5 text-accent"></i> Novo Manhwa';
      lucide.createIcons();
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    });

    // Fechar Modal
    closeModal.addEventListener('click', () => modal.classList.add('hidden'));

    // Submit Formulário
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        name: document.getElementById('manhwa-title').value,
        image: document.getElementById('manhwa-img').value,
        genero: document.getElementById('manhwa-genero').value,
        stars: parseInt(document.getElementById('manhwa-stars').value) || 0,
        status: document.getElementById('manhwa-status').value,
        total: parseInt(document.getElementById('manhwa-total').value) || 0,
        read: parseInt(document.getElementById('manhwa-read').value) || 0,
        notes: document.getElementById('manhwa-notes').value
      };

      try {
        if (editingId) {
          await updateDoc(doc(db, 'users', currentUser.uid, 'manhwas', editingId), data);
        } else {
          await addDoc(collection(db, 'users', currentUser.uid, 'manhwas'), data);
        }
        modal.classList.add('hidden');
      } catch (error) {
        console.error("Erro ao salvar Manhwas: ", error);
      }
    });

    // Abrir Modal Editar
    cards.addEventListener('click', async (e) => {
      const card = e.target.closest('.task-card');
      if (!card) return;
      
      const id = card.dataset.id;
      if (!id) return;
      
      editingId = id;
      
      try {
        const docSnap = await getDoc(doc(db, 'users', currentUser.uid, 'manhwas', id));
        if (!docSnap.exists()) {
          console.error("Documento não encontrado!");
          return;
        }
        const data = docSnap.data();
        document.getElementById('manhwa-title').value = data.name || '';
        document.getElementById('manhwa-img').value = data.image || '';
        document.getElementById('manhwa-genero').value = data.genero || '';
        document.getElementById('manhwa-stars').value = data.stars || 0;
        document.getElementById('manhwa-status').value = data.status || 'Lendo';
        document.getElementById('manhwa-total').value = data.total || 0;
        document.getElementById('manhwa-read').value = data.read || 0;
        document.getElementById('manhwa-notes').value = data.notes || '';
        
        deleteBtn.classList.remove('hidden');
        document.getElementById('modal-title').innerHTML = '<i data-lucide="edit" class="w-5 h-5 text-accent"></i> Editar Manhwa';
        lucide.createIcons();
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      } catch (error) {
         console.error("Erro ao buscar Manhwas para edição: ", error);
      }
    });

    // Deletar
    deleteBtn.addEventListener('click', async () => {
      if (!editingId) return;
      if (confirm('Deseja realmente excluir este item?')) {
          try {
            await deleteDoc(doc(db, 'users', currentUser.uid, 'manhwas', editingId));
            modal.classList.add('hidden');
          } catch (error) {
            console.error("Erro ao deletar Manhwas: ", error);
          }
      }
    });

    // Atualizar Filtros
    function updateFilters() {
      // Pega todos os gêneros únicos cadastrados e remove os vazios
      const genero = [...new Set(allMangas.map(m => m.genero).filter(Boolean))];
      filterGenero.innerHTML = '<option value="">Todos os Gêneros</option>' + genero.map(p => `<option value="${p}">${p}</option>`).join('');
    }

    

    // Renderizar
    function render() {
      let filtered = allMangas.filter(m => {
        return (
          (!searchInput.value || m.name.toLowerCase().includes(searchInput.value.toLowerCase())) &&
          (!filterGenero.value || m.genero === filterGenero.value) &&
          (!filterStatus.value || m.status === filterStatus.value) &&
          (!filterStars.value || m.stars == filterStars.value)
        );
      });

      switch (sortSelect.value) {
        case 'name': filtered.sort((a,b) => a.name.localeCompare(b.name)); break;
        case 'stars': filtered.sort((a,b) => b.stars - a.stars); break;
        case 'chapters': filtered.sort((a,b) => (b.total || 0) - (a.total || 0)); break;
        case 'status': filtered.sort((a,b) => a.status.localeCompare(b.status)); break;
      }

      cards.innerHTML = '';
      if (filtered.length === 0) {
        empty.classList.remove('hidden');
        return;
      }
      empty.classList.add('hidden');

      filtered.forEach(m => {
        cards.innerHTML += `
          <div class='task-card rounded-2xl overflow-hidden cursor-pointer p-4 flex gap-4' data-id='${m.id}'>
            <img src='${m.image || 'https://placehold.co/200x300/151515/e0e0e0?text=Capa'}' 
                 class='w-24 h-36 object-cover rounded-xl border border-white/10 shadow-md flex-shrink-0' 
                 onerror="this.src='https://placehold.co/200x300/151515/e0e0e0?text=Capa'; this.onerror=null;">
            
            <div class='flex flex-col justify-between flex-1 py-1 min-w-0'>
              <div>
                <h3 class='text-lg font-bold mb-1 text-white truncate' title="${m.name}">${m.name}</h3>
                <div class="text-sm text-yellow-500 mb-2 tracking-widest">${'★'.repeat(m.stars)}${'☆'.repeat(5 - m.stars)}</div>
                
                <div class="flex flex-wrap gap-2">
                    <span class='text- uppercase font-bold px-2 py-1 rounded-md bg-white/5 border border-white/10 text-gray-300 inline-block truncate'>
                        ${m.status}
                    </span>
                    ${m.genero ? `<span class='text- uppercase font-bold px-2 py-1 rounded-md bg-accent/20 border border-white/10 text-accent inline-block truncate'>
                        ${m.genero}
                    </span>` : ''}
                </div>
              </div>
              
              <p class='text-xs text-gray-500 font-semibold mt-3'>
                  Capítulos: <span class="text-accent text-sm font-bold">${m.read || 0}</span> <span class="opacity-50">/ ${m.total || 0}</span>
              </p>
            </div>
          </div>`;

          
      });
    }

    [searchInput, filterGenero, filterStatus, filterStars, sortSelect].forEach(el => el.addEventListener('input', render));

  </script>
</body>
</html>
