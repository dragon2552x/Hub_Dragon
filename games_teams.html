<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Meus Times & Guildas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: Inter, system-ui, sans-serif; background:#0b0b0b; color:#e6e6e6; }
    
    /* --- GERAL --- */
    .list-container { display: flex; flex-direction: column; gap: 1rem; }
    .team-card { background:#151515; border:1px solid #2a2a2a; transition:all .3s ease; display: flex; flex-direction: column; border-radius: 0.75rem; overflow: hidden; }
    @media (min-width: 768px) { .team-card { flex-direction: row; height: 160px; } }
    .team-card:hover { border-color:#B9314F; transform:translateY(-2px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.5); }
    .action-section { background: #101010; display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem; border-top: 1px solid #2a2a2a; }
    @media (min-width: 768px) { .action-section { border-top: none; border-left: 1px solid #2a2a2a; flex-direction: column; width: 80px; flex-shrink: 0; padding: 0; gap: 0.5rem; } }
    .btn-icon { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 0.5rem; color: #6b7280; transition: all 0.2s; background: transparent; border: 1px solid transparent; }
    .btn-icon:hover { background: #2a2a2a; color: #e5e7eb; border-color: #374151; }
    .btn-icon.edit:hover { color: #3b82f6; } 
    .btn-icon.members:hover { color: #B9314F; } 
    .btn-icon.view:hover { color: #10b981; } 
    .btn-primary { background:#B9314F; color: white; }
    .btn-primary:hover { background:#99233b; }
    .modal-input { background-color: #1f2937; border: 1px solid #374151; color: white; }
    .modal-input:focus { outline: none; border-color: #B9314F; }
    .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    .custom-scroll::-webkit-scrollbar-track { background: #111; }
    .avatar-fallback-container { display: flex; align-items: center; justify-content: center; background-color: #262626; color: #a3a3a3; font-weight: bold; text-transform: uppercase; user-select: none; }

    /* --- CAMPO DE FUTEBOL (RETRATO) --- */
    .soccer-field-container {
        background-color: #1a1a1a; /* Cor do gramado (Cinza Escuro) */
        position: relative;
        width: 100%;
        height: 100%;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
    }
    
    /* Linhas do Campo (CSS Puro) */
    .pitch-lines {
        position: absolute; inset: 15px; border: 2px solid rgba(255,255,255,0.15); pointer-events: none;
    }
    .pitch-lines::before { /* Linha de Meio Campo */
        content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 2px; background: rgba(255,255,255,0.15); transform: translateY(-50%);
    }
    .pitch-lines::after { /* Círculo Central */
        content: ''; position: absolute; top: 50%; left: 50%; width: 100px; height: 100px; 
        border: 2px solid rgba(255,255,255,0.15); border-radius: 50%; transform: translate(-50%, -50%);
    }
    /* Pequenas áreas (Gol) */
    .goal-area-top { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); width: 40%; height: 60px; border: 2px solid rgba(255,255,255,0.15); border-top: none; }
    .goal-area-bottom { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); width: 40%; height: 60px; border: 2px solid rgba(255,255,255,0.15); border-bottom: none; }

    /* --- TOKEN DO JOGADOR (NOVO ESTILO) --- */
    .player-token {
        position: absolute; transform: translate(-50%, -50%);
        display: flex; flex-direction: column; align-items: center;
        z-index: 10; cursor: default;
        width: 80px; /* Largura da área de toque */
    }
    .player-token:hover { z-index: 20; transform: translate(-50%, -55%); transition: transform 0.2s; }
    
    /* Imagem Grande (Foco) */
    .token-img-wrapper {
        width: 64px; height: 64px; /* w-16 h-16 */
        border-radius: 50%;
        border: 3px solid #1a1a1a;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        overflow: hidden;
        background: #222;
        margin-bottom: 4px;
        position: relative;
    }
    .token-img-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    
    /* Texto Pequeno (Detalhe) */
    .token-info {
        text-align: center;
        background: rgba(0, 0, 0, 0.7);
        padding: 2px 6px;
        border-radius: 4px;
        backdrop-filter: blur(2px);
    }
    .token-name { font-size: 10px; color: white; font-weight: 700; line-height: 1; margin-bottom: 2px; white-space: nowrap; }
    .token-pos { font-size: 9px; color: #B9314F; font-weight: 600; text-transform: uppercase; line-height: 1; }

    /* --- TCG CARD STYLE --- */
    .tcg-card {
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 10px 20px -5px rgba(0,0,0,0.5);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        display: flex;
        flex-direction: column;
        height: 420px; /* Altura fixa para uniformidade */
        user-select: none;
    }
    
    /* Efeito Hover (Levantar e Brilho) */
    .tcg-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 30px -10px rgba(185, 49, 79, 0.3); /* Sombra avermelhada */
        border-color: #B9314F;
        z-index: 10;
    }

    /* Moldura interna (Look de Carta) */
    .tcg-frame {
        padding: 8px;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 8px;
        background: linear-gradient(to bottom, #222, #111);
    }

    /* Imagem da Carta */
    .tcg-art {
        flex: 1; /* Ocupa o espaço disponível */
        width: 100%;
        background: #000;
        border: 2px solid #444;
        border-radius: 4px;
        overflow: hidden;
        position: relative;
    }
    .tcg-art img { width: 100%; height: 100%; object-fit: cover; }

    /* Cabeçalho (Nome) */
    .tcg-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #2a2a2a;
        border: 1px solid #444;
        padding: 6px 10px;
        border-radius: 6px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
    }
    .tcg-name { font-weight: 700; color: #e5e7eb; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }
    
    /* Caixa de Texto (Descrição/Obs) */
    .tcg-textbox {
        height: 100px; /* Altura fixa para texto */
        background: #181818;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 8px;
        font-size: 0.75rem;
        color: #a3a3a3;
        overflow-y: auto;
        font-family: 'Courier New', monospace; /* Fonte estilo máquina de escrever/RPG */
        line-height: 1.4;
    }
    /* Scrollbar fina para a caixa de texto */
    .tcg-textbox::-webkit-scrollbar { width: 4px; }
    .tcg-textbox::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

    /* Rodapé da carta (Tipo/Raridade fictícia) */
    .tcg-footer {
        display: flex;
        justify-content: center;
        border-top: 1px solid #333;
        padding-top: 4px;
    }
    .tcg-badge { font-size: 9px; color: #666; text-transform: uppercase; letter-spacing: 1px; }

  </style>
</head>
<body class="min-h-screen pb-20 custom-scroll">

  <div id="loading" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80">
    <div class="flex flex-col items-center">
      <div class="animate-spin h-12 w-12 border-4 border-t-transparent border-[#B9314F] rounded-full mb-4"></div>
      <p class="text-gray-400 animate-pulse">Carregando...</p>
    </div>
  </div>

  <div id="app" class="container mx-auto p-4 max-w-5xl hidden">
    <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 bg-[#151515] p-4 rounded-xl border border-[#2a2a2a]">
      <div class="flex items-center gap-3">
        <button onclick="window.location.href='home.html'" class="p-2 rounded-full hover:bg-gray-800 transition"><i data-lucide="arrow-left" class="text-[#B9314F]"></i></button>
        <div>
          <h1 class="text-2xl font-bold text-white flex items-center gap-2"><i data-lucide="users" class="text-[#B9314F]"></i> Gestão de Times</h1>
          <p class="text-xs text-gray-500 font-mono" id="user-display">Carregando...</p>
        </div>
      </div>
      <div class="flex gap-3">
        <button id="add-btn" class="flex items-center gap-2 bg-[#B9314F] hover:bg-[#99233b] px-5 py-2.5 rounded-lg text-white font-medium transition shadow-lg shadow-red-900/20"><i data-lucide="plus-circle" class="w-5 h-5"></i> Novo Time</button>
        <button id="logout-btn" class="p-2.5 rounded-lg bg-gray-800 hover:bg-red-900/30 text-gray-400 hover:text-red-400 transition border border-gray-700"><i data-lucide="log-out" class="w-5 h-5"></i></button>
      </div>
    </header>
    
    <div class="mb-6 grid grid-cols-1 md:grid-cols-12 gap-4">
      <div class="md:col-span-8 relative">
        <i data-lucide="search" class="absolute left-3 top-3 w-5 h-5 text-gray-500"></i>
        <input id="search-input" type="text" placeholder="Buscar time..." class="w-full pl-10 pr-4 py-3 bg-[#151515] border border-[#2a2a2a] rounded-lg focus:border-[#B9314F] outline-none text-gray-300">
      </div>
      <div class="md:col-span-4">
        <select id="filter-type" class="w-full py-3 px-4 bg-[#151515] border border-[#2a2a2a] rounded-lg focus:border-[#B9314F] outline-none text-gray-300">
          <option value="">Todos os Tipos</option>
          <option value="Pokemon Principal">Pokemon Principal</option>
          <option value="Pokemon Fazenda">Pokemon Fazenda</option>
          <option value="Digimon">Digimon</option>
          <option value="Futebol">Futebol</option>
          <option value="Geral">Geral</option>
        </select>
      </div>
    </div>
    <div id="cards-container" class="list-container"></div>
    <div id="empty-state" class="hidden text-center py-20 text-gray-500">Nenhum time encontrado.</div>
  </div>

  <div id="modal" class="fixed inset-0 bg-black/90 hidden items-center justify-center z-50 backdrop-blur-sm p-4 overflow-hidden">
    <div class="bg-[#151515] border border-[#2a2a2a] rounded-xl w-full max-w-lg shadow-2xl relative flex flex-col max-h-[90vh]">
      <div class="flex justify-between items-center p-6 border-b border-[#2a2a2a]">
        <h2 class="text-xl font-bold text-white flex items-center gap-2"><i data-lucide="shield" class="text-[#B9314F]"></i> <span id="modal-title-text">Time</span></h2>
        <button id="close-modal" class="text-gray-400 hover:text-white transition"><i data-lucide="x" class="w-6 h-6"></i></button>
      </div>
      <form id="team-form" class="p-6 space-y-5 overflow-y-auto custom-scroll">
        <input type="hidden" id="team-id">
        <div><label class="block text-sm font-medium text-gray-400 mb-1">Nome</label><input id="team-name" type="text" class="w-full p-3 rounded-lg modal-input" required></div>
        <div><label class="block text-sm font-medium text-gray-400 mb-1">Jogo</label><input id="team-game" list="games-list" type="text" class="w-full p-3 rounded-lg modal-input" required><datalist id="games-list"></datalist></div>
        <div><label class="block text-sm font-medium text-gray-400 mb-1">Tipo</label>
            <select id="team-type" class="w-full p-3 rounded-lg modal-input">
                <option value="Geral">Geral</option>
                <option value="Pokemon Principal">Pokemon Principal</option>
                <option value="Pokemon Fazenda">Pokemon Fazenda</option>
                <option value="Digimon">Digimon</option>
                <option value="Futebol">Futebol</option>
            </select></div>
        <div><label class="block text-sm font-medium text-gray-400 mb-1">Banner (URL)</label><input id="team-img" type="url" class="w-full p-3 rounded-lg modal-input"></div>
        <div class="flex justify-between items-center pt-4 border-t border-[#2a2a2a] mt-4">
            <button id="delete-btn" type="button" class="hidden text-red-500 hover:text-red-400 text-sm font-medium">Excluir</button>
            <button type="submit" class="px-6 py-2 rounded-lg btn-primary font-medium ml-auto">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="members-modal" class="fixed inset-0 bg-black/95 hidden items-center justify-center z-[60] backdrop-blur-md p-2 sm:p-4">
    <div class="bg-[#151515] border border-[#2a2a2a] rounded-xl w-full max-w-5xl h-[90vh] shadow-2xl relative flex flex-col md:flex-row overflow-hidden">
        <div class="w-full md:w-80 border-b md:border-b-0 md:border-r border-[#2a2a2a] flex flex-col bg-[#111] h-1/3 md:h-full shrink-0">
            <div class="p-3 border-b border-[#2a2a2a] bg-[#1a1a1a]"><h3 class="font-bold text-white text-sm flex items-center gap-2"><i data-lucide="users" class="w-4 h-4 text-[#B9314F]"></i> Integrantes</h3><p id="member-team-name" class="text-[10px] text-gray-500 truncate mt-1">-</p></div>
            <div id="members-list" class="flex-1 overflow-y-auto p-2 space-y-2 custom-scroll"></div>
            <div class="p-3 border-t border-[#2a2a2a] bg-[#111]"><button onclick="prepareNewMember()" class="w-full py-2 bg-[#2a2a2a] hover:bg-[#B9314F] text-gray-300 hover:text-white rounded-lg transition text-xs font-bold flex items-center justify-center gap-2"><i data-lucide="plus" class="w-4 h-4"></i> Novo Integrante</button></div>
        </div>
        <div class="flex-1 flex flex-col bg-[#151515] relative min-h-0">
            <div class="p-3 border-b border-[#2a2a2a] flex justify-between items-center shrink-0"><h3 id="member-form-title" class="font-bold text-white text-sm">Adicionar / Editar</h3><button onclick="closeMembersModal()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button></div>
            <div id="member-form-container" class="flex-1 overflow-y-auto p-4 md:p-6 hidden custom-scroll">
                <form id="member-form" class="space-y-4 max-w-lg mx-auto pb-4">
                    <input type="hidden" id="member-id">
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Nome</label><input id="member-name" type="text" class="w-full p-2.5 rounded-lg modal-input text-sm" required></div>
                    <div><label class="block text-xs font-bold text-gray-500 uppercase mb-1">Avatar (URL)</label><input id="member-avatar" type="url" class="w-full p-2.5 rounded-lg modal-input text-sm"><p class="text-[10px] text-gray-500 mt-1">Se falhar, usaremos a inicial.</p></div>
                    <div id="dynamic-fields" class="p-4 bg-[#1a1a1a] rounded-lg border border-[#333] space-y-4"></div>
                    <div class="flex justify-between items-center pt-4 mt-2 border-t border-[#2a2a2a]"><button type="button" id="btn-delete-member" class="text-red-500 hover:text-red-300 text-xs font-bold uppercase hidden">Excluir</button><button type="submit" class="px-6 py-2 rounded-lg btn-primary text-sm font-bold shadow-lg ml-auto">Salvar</button></div>
                </form>
            </div>
            <div id="member-empty-state" class="flex-1 flex flex-col items-center justify-center text-gray-600 p-10"><i data-lucide="user-plus" class="w-12 h-12 mb-3 opacity-50"></i><p class="text-sm text-center">Selecione ou crie um novo.</p></div>
        </div>
    </div>
  </div>

  <div id="soccer-visualizer-modal" class="fixed inset-0 bg-[#0b0b0b] hidden z-[70] flex flex-col">
      <div class="bg-[#151515] border-b border-[#2a2a2a] p-3 flex justify-between items-center shrink-0">
          <div class="flex items-center gap-4">
              <h3 class="text-white font-bold flex items-center gap-2"><i data-lucide="layout-template" class="text-[#B9314F]"></i> Prancheta Tática</h3>
              <select id="formation-select" class="bg-[#2a2a2a] text-white text-sm border border-[#333] rounded px-3 py-1.5 outline-none focus:border-[#B9314F]"></select>
          </div>
          <button onclick="closeSoccerVisualizer()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
      </div>
      <div class="flex-1 flex overflow-hidden relative">
          
          <div class="flex-1 bg-[#111] flex items-center justify-center p-2 sm:p-6 overflow-hidden relative">
              
              <button id="toggle-sidebar-btn" onclick="toggleSoccerSidebar()" 
                      class="absolute right-0 top-1/2 -translate-y-1/2 z-40 bg-[#2a2a2a] border-l border-y border-[#333] text-gray-400 hover:text-[#B9314F] hover:bg-[#222] p-1 rounded-l-lg shadow-lg transition-colors h-16 flex items-center justify-center">
                  <i data-lucide="chevron-right" class="w-5 h-5"></i>
              </button>

              <div class="relative h-full aspect-[3/5] max-h-[85vh] max-w-full transition-all duration-300">
                  <div id="soccer-field" class="soccer-field-container w-full h-full">
                      <div class="pitch-lines"></div>
                      <div class="goal-area-top"></div>
                      <div class="goal-area-bottom"></div>
                      <div id="field-players-container" class="absolute inset-0"></div>
                  </div>
              </div>
          </div>

          <div id="soccer-sidebar" class="w-64 bg-[#111] border-l border-[#2a2a2a] flex flex-col shrink-0 transition-all duration-300 ease-in-out overflow-hidden">
              <div class="flex-1 flex flex-col p-3 border-b border-[#2a2a2a] overflow-hidden">
                  <h4 class="text-xs font-bold text-gray-500 uppercase mb-3 flex items-center gap-1"><i data-lucide="users" class="w-3 h-3"></i> Reservas</h4>
                  <div id="subs-list" class="space-y-2 overflow-y-auto custom-scroll pr-1 flex-1"></div>
                  <div id="subs-overflow" class="hidden mt-2 text-center text-xs text-gray-500 p-2 bg-[#1a1a1a] rounded">+X Jogadores</div>
              </div>
              <div class="h-1/3 p-3 bg-[#151515] flex flex-col overflow-hidden">
                  <h4 class="text-xs font-bold text-gray-500 uppercase mb-3 flex items-center gap-1"><i data-lucide="clipboard" class="w-3 h-3"></i> Comissão</h4>
                  <div id="coaches-list" class="space-y-2 overflow-y-auto custom-scroll pr-1"></div>
              </div>
          </div>
      </div>
  </div>

  <div id="general-visualizer-modal" class="fixed inset-0 bg-[#0b0b0b] hidden z-[70] flex flex-col overflow-hidden">
      <div class="absolute top-0 left-0 right-0 p-4 z-10 flex justify-between items-start pointer-events-none">
          <div class="pointer-events-auto bg-[#151515]/90 backdrop-blur border border-[#333] px-4 py-2 rounded-lg shadow-2xl">
              <h2 id="gen-viz-title" class="text-xl font-bold text-white flex items-center gap-2">
                  <i data-lucide="library" class="text-[#B9314F]"></i> <span>Nome do Time</span>
              </h2>
              <p class="text-[10px] text-gray-400 uppercase tracking-widest mt-0.5">Coleção de Membros</p>
          </div>
          <button onclick="closeGeneralVisualizer()" class="pointer-events-auto bg-[#151515]/90 hover:bg-[#B9314F] text-white border border-[#333] rounded-full p-2 transition shadow-xl">
              <i data-lucide="x" class="w-6 h-6"></i>
          </button>
      </div>

      <div class="absolute inset-0 z-0 opacity-20 pointer-events-none" 
           style="background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px;">
      </div>

      <div class="flex-1 overflow-y-auto custom-scroll z-0 pt-24 pb-10 px-4 sm:px-10">
          <div id="general-cards-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 max-w-7xl mx-auto">
              </div>
      </div>
  </div>

  <div id="pokemon-visualizer-modal" class="fixed inset-0 bg-[#121212] hidden z-[70] flex flex-col overflow-hidden">
      <div class="relative z-10 p-4 flex justify-between items-center bg-[#1a1a1a] border-b border-[#333] shadow-md">
          <div class="flex items-center gap-3">
              <div class="bg-red-600 text-white p-2 rounded-full shadow-lg border border-red-400">
                  <img src="https://cdn-icons-png.flaticon.com/512/188/188987.png" class="w-6 h-6 invert brightness-0"> </div>
              <div>
                  <h2 id="poke-viz-title" class="text-xl font-bold text-white tracking-wide">Hall of Fame</h2>
                  <p class="text-[10px] text-gray-400 uppercase font-mono">Registro de Campeão</p>
              </div>
          </div>
          <button onclick="closePokemonVisualizer()" class="text-gray-400 hover:text-white bg-[#2a2a2a] hover:bg-red-600 p-2 rounded-full transition">
              <i data-lucide="x" class="w-6 h-6"></i>
          </button>
      </div>

      <div class="flex-1 overflow-y-auto custom-scroll relative bg-[#121212]">
          <div class="absolute inset-0 opacity-10 pointer-events-none" 
               style="background-image: repeating-linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%, #222), repeating-linear-gradient(45deg, #222 25%, #121212 25%, #121212 75%, #222 75%, #222); background-position: 0 0, 10px 10px; background-size: 20px 20px;"></div>

          <div class="container mx-auto px-4 py-8 relative z-0 flex flex-col items-center gap-12">
              
              <div class="w-full max-w-4xl">
                  <h3 class="text-center text-white/50 text-sm uppercase tracking-[0.3em] mb-6 border-b border-white/10 pb-2">Time Principal</h3>
                  <div id="poke-main-grid" class="grid grid-cols-2 md:grid-cols-3 gap-y-10 gap-x-8 justify-items-center">
                      </div>
              </div>

              <div id="poke-extra-container" class="w-full max-w-5xl hidden">
                  <h3 class="text-center text-white/50 text-sm uppercase tracking-[0.3em] mb-6 border-b border-white/10 pb-2">Caixa / Histórico</h3>
                  <div id="poke-extra-grid" class="flex flex-wrap justify-center gap-4">
                      </div>
              </div>
          </div>
      </div>
  </div>

  <div id="pokemon-farm-modal" class="fixed inset-0 bg-[#121212] hidden z-[70] flex flex-col overflow-hidden">
      <div class="relative z-10 p-4 flex justify-between items-center bg-[#1a1a1a] border-b border-[#333] shadow-md">
          <div class="flex items-center gap-3">
              <div class="bg-green-600 text-white p-2 rounded-full shadow-lg border border-green-400">
                  <i data-lucide="sprout" class="w-6 h-6"></i>
              </div>
              <div>
                  <h2 id="farm-viz-title" class="text-xl font-bold text-white tracking-wide">Minha Fazenda</h2>
                  <p class="text-[10px] text-gray-400 uppercase font-mono">Coleção Agrupada</p>
              </div>
          </div>
          <button onclick="closeFarmVisualizer()" class="text-gray-400 hover:text-white bg-[#2a2a2a] hover:bg-green-600 p-2 rounded-full transition">
              <i data-lucide="x" class="w-6 h-6"></i>
          </button>
      </div>

      <div class="flex-1 overflow-y-auto custom-scroll relative bg-[#0f0f0f]">
          <div class="absolute inset-0 opacity-5 pointer-events-none" 
               style="background-image: radial-gradient(#444 1px, transparent 1px); background-size: 30px 30px;"></div>

          <div class="container mx-auto px-4 py-8 relative z-0">
              <div id="farm-groups-container" class="flex flex-col gap-12 pb-20"></div>
          </div>
      </div>
  </div>

  <div id="digimon-visualizer-modal" class="fixed inset-0 bg-[#050510] hidden z-[70] flex flex-col overflow-hidden">
      <div class="relative z-10 p-4 flex justify-between items-center bg-[#0a0a15] border-b border-blue-900/30 shadow-[0_0_15px_rgba(0,181,226,0.1)]">
          <div class="flex items-center gap-3">
              <div class="bg-blue-600 text-white p-2 rounded sm:rounded-tl-xl sm:rounded-br-xl shadow-[0_0_10px_#2563eb]">
                  <i data-lucide="cpu" class="w-6 h-6"></i>
              </div>
              <div>
                  <h2 id="digi-viz-title" class="text-xl font-bold text-white tracking-widest uppercase font-mono" style="text-shadow: 0 0 5px rgba(255,255,255,0.5);">Digivice</h2>
                  <p class="text-[10px] text-blue-400 uppercase font-mono tracking-widest">Digital Monster DB</p>
              </div>
          </div>
          <button onclick="closeDigimonVisualizer()" class="text-blue-500 hover:text-white hover:bg-blue-600/20 p-2 rounded transition">
              <i data-lucide="x" class="w-6 h-6"></i>
          </button>
      </div>

      <div class="flex-1 overflow-y-auto custom-scroll relative bg-[#050510]">
          <div class="absolute inset-0 opacity-10 pointer-events-none" 
               style="background-image: radial-gradient(#1e3a8a 1px, transparent 1px); background-size: 40px 40px;"></div>
          
          <div class="container mx-auto px-4 py-8 relative z-0 flex flex-col gap-10">
              <div id="digimon-groups-container" class="space-y-12 pb-20">
                  </div>
          </div>
      </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, query, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    /* =========================================================
       ÁREA DE CONFIGURAÇÃO DE TÁTICAS FÁCIL
       Adicione novas formações aqui.
       t (top): 0% = Gol Adversário (Topo) | 100% = Nosso Gol (Baixo)
       l (left): 0% = Esquerda | 100% = Direita
    ========================================================= */
    const TACTICS_CONFIG = {
        '4-3-3': {
            'Goleiro':  [{t:92,l:50}],
            'Zagueiro': [{t:80,l:30},{t:80,l:70}],
            'Lateral':  [{t:75,l:10},{t:75,l:90}],
            'Volante':  [{t:60,l:50}],
            'Meia':     [{t:50,l:30},{t:50,l:70}],
            'Atacante': [{t:25,l:15},{t:20,l:50},{t:25,l:85}]
        },
        '3-5-2': {
             'Goleiro':  [{t:92,l:50}],
             'Zagueiro': [{t:75,l:50}],
             'Lateral':  [{t:75,l:25},{t:75,l:75}],
             'Volante':  [{t:60,l:50}],
             'Meia':     [{t:50,l:30},{t:50,l:70}, {t:35,l:20},{t:35,l:80}],
             'Atacante': [{t:15,l:30},{t:15,l:70}]
        },
        '4-4-2': {
            'Goleiro':  [{t:92,l:50}],
            'Zagueiro': [{t:80,l:35},{t:80,l:65}],
            'Lateral':  [{t:75,l:10},{t:75,l:90}],
            'Volante':  [{t:60,l:40},{t:60,l:60}],
            'Meia':     [{t:45,l:15},{t:45,l:85}],
            'Atacante': [{t:20,l:35},{t:20,l:65}]
        },
        // Adicione mais aqui se quiser...
    };

    const POKE_TYPES = [
        'Normal', 'Fire', 'Water', 'Grass', 'Electric', 'Ice', 'Fighting', 'Poison', 'Ground', 
        'Flying', 'Psychic', 'Bug', 'Rock', 'Ghost', 'Dragon', 'Steel', 'Dark', 'Fairy'
    ];

    const TYPE_COLORS = {
        Normal: '#A8A77A', Fire: '#EE8130', Water: '#6390F0', Electric: '#F7D02C',
        Grass: '#7AC74C', Ice: '#96D9D6', Fighting: '#C22E28', Poison: '#A33EA1',
        Ground: '#E2BF65', Flying: '#A98FF3', Psychic: '#F95587', Bug: '#A6B91A',
        Rock: '#B6A136', Ghost: '#735797', Dragon: '#6F35FC', Steel: '#B7B7CE',
        Dark: '#705746', Fairy: '#D685AD', None: '#333333'
    };

    // --- CONSTANTES DIGIMON ---
    const DIGI_TYPES = {
        'Vaccine': { color: '#00B5E2', icon: 'shield-check', label: 'Vacina' }, // Azul/Teal
        'Virus': { color: '#9d4dbb', icon: 'skull', label: 'Vírus' },          // Roxo
        'Data': { color: '#EAB308', icon: 'database', label: 'Dados' },        // Amarelo/Laranja
        'Free': { color: '#22C55E', icon: 'circle-dashed', label: 'Livre' }    // Verde
    };

    const DIGI_ATTRS = {
        'Fire': { color: '#EF4444', icon: 'flame', label: 'Fogo' },
        'Water': { color: '#3B82F6', icon: 'droplet', label: 'Água' },
        'Plant': { color: '#4ADE80', icon: 'leaf', label: 'Planta' },
        'Electric': { color: '#FACC15', icon: 'zap', label: 'Elétrico' },
        'Earth': { color: '#A16207', icon: 'mountain', label: 'Terra' },
        'Wind': { color: '#2DD4BF', icon: 'wind', label: 'Vento' },
        'Light': { color: '#FEF08A', icon: 'sun', label: 'Luz' },
        'Dark': { color: '#581C87', icon: 'moon', label: 'Trevas' },
        'Steel': { color: '#94A3B8', icon: 'wrench', label: 'Metal' }, // Representado por chave inglesa/ferramenta
        'Neutral': { color: '#737373', icon: 'circle', label: 'Neutro' }
    };

    const firebaseConfig = { apiKey: "AIzaSyDsbiLPBOda119Qr6Ji69j8TZLpiFixBWI", authDomain: "list-games-9bddd.firebaseapp.com", projectId: "list-games-9bddd", storageBucket: "list-games-9bddd.firebasestorage.app", messagingSenderId: "756898313156", appId: "1:756898313156:web:9bc660d0a2f4cd07882a91" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null, allTeams = [], allGames = [], editingId = null, currentTeamMembers = [], currentTeamData = null;

    const els = {
        app: document.getElementById('app'), loading: document.getElementById('loading'), cards: document.getElementById('cards-container'), empty: document.getElementById('empty-state'),
        modal: document.getElementById('modal'), form: document.getElementById('team-form'), modalTitle: document.getElementById('modal-title-text'),
        search: document.getElementById('search-input'), filterType: document.getElementById('filter-type'), datalist: document.getElementById('games-list'),
        inputs: { name: document.getElementById('team-name'), game: document.getElementById('team-game'), img: document.getElementById('team-img'), type: document.getElementById('team-type') },
        btns: { add: document.getElementById('add-btn'), close: document.getElementById('close-modal'), delete: document.getElementById('delete-btn'), logout: document.getElementById('logout-btn') },
        membersModal: document.getElementById('members-modal'), membersList: document.getElementById('members-list'), memberFormContainer: document.getElementById('member-form-container'),
        memberEmptyState: document.getElementById('member-empty-state'), memberForm: document.getElementById('member-form'),
        memberInputs: { id: document.getElementById('member-id'), name: document.getElementById('member-name'), avatar: document.getElementById('member-avatar'), dynamic: document.getElementById('dynamic-fields') },
        btnDeleteMember: document.getElementById('btn-delete-member'), memberTeamName: document.getElementById('member-team-name'),
        soccerModal: document.getElementById('soccer-visualizer-modal'), formationSelect: document.getElementById('formation-select'), fieldPlayersContainer: document.getElementById('field-players-container'),
        subsList: document.getElementById('subs-list'), subsOverflow: document.getElementById('subs-overflow'), coachesList: document.getElementById('coaches-list'),
        generalModal: document.getElementById('general-visualizer-modal'),
        generalGrid: document.getElementById('general-cards-grid'),
        generalTitle: document.getElementById('gen-viz-title'),
    };

    const toggleLoading = (show) => { if(show) { els.loading.classList.remove('hidden'); els.app.classList.add('hidden'); } else { els.loading.classList.add('hidden'); els.app.classList.remove('hidden'); lucide.createIcons(); } };
    const getTypeColor = (type) => { switch(type) { case 'Pokemon': return 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20'; case 'Digimon': return 'bg-blue-500/10 text-blue-400 border-blue-500/20'; case 'Futebol': return 'bg-green-500/10 text-green-400 border-green-500/20'; default: return 'bg-gray-700/30 text-gray-300 border-gray-600'; } };
    
    // Função Avatar com Fallback Seguro (Alta Qualidade)
    const generateAvatarHTML = (avatarUrl, name, sizeClass = "w-10 h-10") => {
        const initial = name ? name.charAt(0).toUpperCase() : '?';
        const fallbackHtml = `<div class='${sizeClass} avatar-fallback-container rounded-full border border-[#444] shadow-sm bg-[#222]'>${initial}</div>`;
        if (!avatarUrl || avatarUrl.trim() === '') return fallbackHtml;
        // Limpa URL da wikia se necessário para pegar imagem full
        if (avatarUrl.includes('static.wikia')) avatarUrl = avatarUrl.split('/revision/')[0];
        
        return `<img src="${avatarUrl}" class="${sizeClass} rounded-full object-cover border border-[#444] bg-[#222]" 
                     style="image-rendering: -webkit-optimize-contrast;" alt="${name}" 
                     onerror="this.parentElement.innerHTML=\`${fallbackHtml}\`">`;
    };

    // --- VISUALIZADOR TÁTICO ---
    // Popula o select de formações baseado na config
    Object.keys(TACTICS_CONFIG).forEach(f => {
        const opt = document.createElement('option'); opt.value = f; opt.textContent = f; els.formationSelect.appendChild(opt);
    });

    window.openSoccerVisualizer = (team) => {
        if(team.type !== 'Futebol') { alert('Disponível apenas para Futebol.'); return; }
        currentTeamData = team;
        els.soccerModal.classList.remove('hidden');
        renderSoccerLayout();
    };
    window.closeSoccerVisualizer = () => els.soccerModal.classList.add('hidden');
    els.formationSelect.addEventListener('change', () => renderSoccerField());

    const renderSoccerLayout = () => {
        const members = currentTeamData.members || [];
        const titulares = members.filter(m => m.status === 'Titular' && m.posicao !== 'Técnico');
        const reservas = members.filter(m => m.status === 'Reserva' && m.posicao !== 'Técnico');
        const tecnicos = members.filter(m => m.posicao === 'Técnico');
        renderSoccerField(titulares);
        renderSoccerSidebar(reservas, tecnicos);
    }

    const renderSoccerField = (titularesList) => {
        els.fieldPlayersContainer.innerHTML = '';
        const formationId = els.formationSelect.value;
        const slotsConfig = TACTICS_CONFIG[formationId];
        if(!slotsConfig) return;
        
        let playersToPlace = titularesList || currentTeamData.members.filter(m => m.status === 'Titular' && m.posicao !== 'Técnico');

        for (const [posicaoName, slots] of Object.entries(slotsConfig)) {
            slots.forEach((coords) => {
                const playerIndex = playersToPlace.findIndex(p => p.posicao === posicaoName);
                if(playerIndex > -1) {
                    const player = playersToPlace[playerIndex];
                    playersToPlace.splice(playerIndex, 1);

                    // Cria o TOKEN no campo
                    const token = document.createElement('div');
                    token.className = 'player-token group/token';
                    token.style.top = `${coords.t}%`;
                    token.style.left = `${coords.l}%`;
                    
                    token.innerHTML = `
                        <div class="token-img-wrapper">
                            ${generateAvatarHTML(player.avatar, player.name, "w-full h-full")}
                        </div>
                        <div class="token-info">
                             <div class="token-name">${player.name.split(' ')[0]}</div>
                             <div class="token-pos">${player.posicao} ${player.numero ? '#'+player.numero : ''}</div>
                        </div>
                    `;
                    els.fieldPlayersContainer.appendChild(token);
                }
            });
        }
    };

    const renderSoccerSidebar = (reservas, tecnicos) => {
        els.subsList.innerHTML = ''; const maxSubs = 7;
        reservas.slice(0, maxSubs).forEach(sub => {
             const item = document.createElement('div'); item.className = "flex items-center gap-2 p-2 bg-[#1a1a1a] rounded border border-[#2a2a2a]";
             item.innerHTML = `<div class="shrink-0">${generateAvatarHTML(sub.avatar, sub.name, "w-8 h-8")}</div><div class="min-w-0"><p class="text-sm text-white font-bold truncate leading-none">${sub.name}</p><p class="text-[10px] text-gray-500">${sub.posicao} #${sub.numero||'?'}</p></div>`;
             els.subsList.appendChild(item);
        });
        if(reservas.length > maxSubs) { els.subsOverflow.textContent = `+${reservas.length - maxSubs} Jogadores`; els.subsOverflow.classList.remove('hidden'); } else els.subsOverflow.classList.add('hidden');

        els.coachesList.innerHTML = '';
        tecnicos.slice(0, 3).forEach(coach => {
             const item = document.createElement('div'); item.className = "flex items-center gap-2 p-2 bg-[#1a1a1a] rounded border border-[#B9314F]/30";
             item.innerHTML = `<div class="shrink-0">${generateAvatarHTML(coach.avatar, coach.name, "w-8 h-8")}</div><div class="min-w-0"><p class="text-sm text-white font-bold truncate leading-none">${coach.name}</p><p class="text-[10px] text-[#B9314F]">Técnico</p></div>`;
             els.coachesList.appendChild(item);
        });
    };

    // --- CORE (Render, CRUD, Auth) ---
    const render = () => {
        const term = els.search.value.toLowerCase(); const typeFilter = els.filterType.value;
        const filtered = allTeams.filter(t => (t.name.toLowerCase().includes(term) || t.game.toLowerCase().includes(term)) && (!typeFilter || t.type === typeFilter));
        els.cards.innerHTML = '';
        if (filtered.length === 0) els.empty.classList.remove('hidden');
        else {
            els.empty.classList.add('hidden');
            filtered.forEach(t => {
                const imgSource = t.img || 'https://placehold.co/300x200/2a2a2a/B9314F?text=No+Image'; const members = t.members || [];
                let membersStackHTML = '';
                if (members.length > 0) {
                    const maxDisplay = 10; const displayMembers = members.slice(0, maxDisplay); const remaining = members.length - maxDisplay;
                    const avatars = displayMembers.map(m => `<div class="relative -ml-2 transition-transform hover:-translate-y-1 hover:z-10"><div class="avatar-wrapper">${generateAvatarHTML(m.avatar, m.name, "w-11 h-11")}</div></div>`).join('');
                    const plusBubble = remaining > 0 ? `<div class="relative -ml-2 z-0 w-8 h-8 rounded-full bg-[#222] border border-[#333] text-gray-400 text-[10px] font-bold flex items-center justify-center">+${remaining}</div>` : '';
                    membersStackHTML = `<div class="flex items-center pl-2 mt-3 h-9">${avatars}${plusBubble}</div>`;
                } else membersStackHTML = `<p class="text-xs text-gray-600 mt-3 italic pl-1 h-9 flex items-center">Sem integrantes</p>`;

                const card = document.createElement('div'); card.className = 'team-card group';
                card.innerHTML = `
                    <div class="w-full md:w-56 h-32 md:h-full relative shrink-0 bg-black"><img src="${imgSource}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" onerror="this.src='https://placehold.co/300x200/2a2a2a/B9314F?text=No+Image'"><div class="absolute inset-0 bg-gradient-to-t from-[#151515] to-transparent md:hidden"></div></div>
                    <div class="flex-1 p-4 md:p-5 flex flex-col justify-between relative"><div><div class="flex items-center gap-2 mb-2"><span class="text-[10px] font-bold uppercase tracking-wider text-[#B9314F]">${t.game}</span><span class="text-[10px] px-2 py-0.5 rounded border ${getTypeColor(t.type)}">${t.type}</span></div><h3 class="text-xl md:text-2xl font-bold text-white mb-1 leading-tight">${t.name}</h3>${membersStackHTML}</div></div>
                    <div class="action-section"><button class="btn-icon edit" title="Editar"><i data-lucide="pencil" class="w-5 h-5"></i></button><button class="btn-icon members" title="Membros"><i data-lucide="users" class="w-5 h-5"></i></button><button class="btn-icon view" title="Ver"><i data-lucide="eye" class="w-5 h-5"></i></button></div>`;
                card.querySelector('.edit').onclick = () => openEditTeamModal(t); card.querySelector('.members').onclick = () => openMembersModal(t);
                
                const viewBtn = card.querySelector('.view');
                
                if (t.type === 'Futebol') {
                    viewBtn.onclick = () => openSoccerVisualizer(t);
                } else if (t.type === 'Geral') {
                    viewBtn.onclick = () => openGeneralVisualizer(t);
                } else if (t.type === 'Pokemon Principal') {
                    viewBtn.onclick = () => openPokemonVisualizer(t);
                } else if (t.type === 'Pokemon Fazenda') {
                    viewBtn.onclick = () => openFarmVisualizer(t);
                }else if (t.type === 'Digimon') {
                    viewBtn.onclick = () => openDigimonVisualizer(t);
                } else {
                    viewBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    viewBtn.onclick = () => alert('Visualização disponível apenas para Futebol e Geral.');
                }

                els.cards.appendChild(card);
            });
        }
        lucide.createIcons();
    };

    // --- Lógica do Toggle da Sidebar ---
    window.toggleSoccerSidebar = () => {
        const sidebar = document.getElementById('soccer-sidebar');
        const btn = document.getElementById('toggle-sidebar-btn');
        const icon = btn.querySelector('i'); // Pega o ícone dentro do botão
        
        // Verifica se está fechado (largura 0)
        if (sidebar.classList.contains('w-0')) {
            // ABRIR
            sidebar.classList.remove('w-0', 'border-l-0', 'opacity-0');
            sidebar.classList.add('w-64', 'border-l');
            
            // Troca ícone para seta direita (para fechar)
            btn.innerHTML = '<i data-lucide="chevron-right" class="w-5 h-5"></i>';
        } else {
            // FECHAR
            sidebar.classList.remove('w-64', 'border-l');
            sidebar.classList.add('w-0', 'border-l-0', 'opacity-0');
            
            // Troca ícone para seta esquerda (para abrir)
            btn.innerHTML = '<i data-lucide="chevron-left" class="w-5 h-5"></i>';
        }
        
        // Recarrega os ícones recém inseridos
        if(typeof lucide !== 'undefined') lucide.createIcons();
    };

    window.toggleSoccerSidebar = window.toggleSoccerSidebar;

    // --- VISUALIZADOR GERAL (TCG) ---
    window.openGeneralVisualizer = (team) => {
        currentTeamData = team;
        els.generalTitle.querySelector('span').textContent = team.name;
        renderGeneralCards(team.members || []);
        els.generalModal.classList.remove('hidden');
    };

    window.closeGeneralVisualizer = () => {
        els.generalModal.classList.add('hidden');
    };

    const renderGeneralCards = (members) => {
        els.generalGrid.innerHTML = '';
        
        if (members.length === 0) {
            els.generalGrid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-20 italic">Este Time está vazio... Adicione membros.</div>`;
            return;
        }

        members.forEach(member => {
            const card = document.createElement('div');
            card.className = 'tcg-card group';
            
            // Fallback de imagem
            let imgHtml = '';
            if (member.avatar && member.avatar.trim() !== '') {
                imgHtml = `<img src="${member.avatar}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                           <div class="hidden w-full h-full bg-[#111] items-center justify-center text-[#333] font-bold text-4xl">${member.name.charAt(0)}</div>`;
            } else {
                imgHtml = `<div class="w-full h-full bg-[#151515] flex items-center justify-center text-[#333] font-bold text-6xl shadow-inner">${member.name.charAt(0)}</div>`;
            }

            // Descrição ou texto padrão
            const obsText = member.obs ? member.obs : "Nenhuma habilidade especial ou observação registrada para este integrante.";

            card.innerHTML = `
                <div class="tcg-frame">
                    <div class="tcg-header">
                        <span class="tcg-name truncate">${member.name}</span>
                        <i data-lucide="sparkles" class="w-3 h-3 text-[#B9314F]"></i>
                    </div>
                    
                    <div class="tcg-art">
                        ${imgHtml}
                    </div>
                    
                    <div class="tcg-textbox custom-scroll">
                        ${obsText}
                    </div>
                    
                    <div class="tcg-footer">
                        <span class="tcg-badge">Unit • Geral</span>
                    </div>
                </div>
            `;
            els.generalGrid.appendChild(card);
        });
        lucide.createIcons();
    };

    // --- VISUALIZADOR POKEMON ---
    const elsPoke = {
        modal: document.getElementById('pokemon-visualizer-modal'),
        title: document.getElementById('poke-viz-title'),
        mainGrid: document.getElementById('poke-main-grid'),
        extraContainer: document.getElementById('poke-extra-container'),
        extraGrid: document.getElementById('poke-extra-grid')
    };

    window.openPokemonVisualizer = (team) => {
        elsPoke.title.textContent = team.name;
        renderPokemonLayout(team.members || []);
        elsPoke.modal.classList.remove('hidden');
    };

    window.closePokemonVisualizer = () => elsPoke.modal.classList.add('hidden');

    const renderPokemonLayout = (members) => {
        elsPoke.mainGrid.innerHTML = '';
        elsPoke.extraGrid.innerHTML = '';
        
        // Separa os 6 primeiros (Main) do resto (Extra)
        const mainTeam = members.slice(0, 6);
        const extraTeam = members.slice(6);

        // Renderiza Time Principal (Cards Grandes)
        mainTeam.forEach(p => elsPoke.mainGrid.appendChild(createPokemonCard(p, true)));

        // Renderiza Extras (Cards Menores)
        if (extraTeam.length > 0) {
            elsPoke.extraContainer.classList.remove('hidden');
            extraTeam.forEach(p => elsPoke.extraGrid.appendChild(createPokemonCard(p, false)));
        } else {
            elsPoke.extraContainer.classList.add('hidden');
        }
    };

    const createPokemonCard = (pokemon, isMain) => {
        // Cores dos Tipos
        const c1 = TYPE_COLORS[pokemon.type1] || '#333';
        const c2 = pokemon.type2 ? TYPE_COLORS[pokemon.type2] : c1;
        
        // Gradiente da Borda (Se tiver 2 tipos, divide a borda)
        const gradientStyle = `linear-gradient(135deg, ${c1}, ${c2})`;

        // Tamanhos baseados se é Principal ou Extra
        const sizeClasses = isMain ? "w-32 h-32 md:w-40 md:h-40" : "w-16 h-16 opacity-80 hover:opacity-100";
        const nameSize = isMain ? "text-lg md:text-xl mt-4" : "hidden"; // Esconde nome dos extras para economizar espaço ou mostra tooltip
        
        const card = document.createElement('div');
        card.className = `flex flex-col items-center group relative ${!isMain ? 'cursor-help' : ''}`;
        if(!isMain) card.title = pokemon.name; // Tooltip simples para os pequenos

        // HTML do Círculo
        card.innerHTML = `
            <div class="${sizeClasses} rounded-full p-[4px] shadow-[0_0_20px_rgba(0,0,0,0.5)] transition-transform duration-300 group-hover:scale-110 relative z-10 bg-[#1a1a1a]"
                 style="background: ${gradientStyle}">
                <div class="w-full h-full rounded-full border-[3px] border-[#1a1a1a] overflow-hidden bg-[#222] relative">
                    ${generateAvatarHTML(pokemon.avatar, pokemon.name, "w-full h-full")}
                </div>
                
                ${isMain ? getTypesBadges(pokemon) : ''}
            </div>
            
            <div class="${nameSize} font-bold text-white text-center drop-shadow-md flex flex-col items-center">
                <span>${pokemon.name}</span>
            </div>
        `;
        return card;
    };

    const getTypesBadges = (pokemon) => {
        // Pequenos ícones/bolinhas de cor flutuando no card principal
        const t1Color = TYPE_COLORS[pokemon.type1];
        const t2Color = pokemon.type2 ? TYPE_COLORS[pokemon.type2] : null;
        
        return `
            <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 flex gap-1">
                <div class="w-4 h-4 rounded-full border border-[#1a1a1a] shadow-sm" style="background:${t1Color}" title="${pokemon.type1}"></div>
                ${t2Color ? `<div class="w-4 h-4 rounded-full border border-[#1a1a1a] shadow-sm" style="background:${t2Color}" title="${pokemon.type2}"></div>` : ''}
            </div>
        `;
    };

    // --- VISUALIZADOR FAZENDA (GROUPS) ---
    const elsFarm = {
        modal: document.getElementById('pokemon-farm-modal'),
        title: document.getElementById('farm-viz-title'),
        container: document.getElementById('farm-groups-container')
    };

    window.openFarmVisualizer = (team) => {
        elsFarm.title.textContent = team.name;
        renderFarmLayout(team.members || []);
        elsFarm.modal.classList.remove('hidden');
    };

    window.closeFarmVisualizer = () => elsFarm.modal.classList.add('hidden');

    const renderFarmLayout = (members) => {
        elsFarm.container.innerHTML = '';

        if (members.length === 0) {
            elsFarm.container.innerHTML = `<div class="text-center text-gray-500 mt-20">A fazenda está vazia.</div>`;
            return;
        }

        // 1. Agrupar membros por chave 'group'
        const grouped = members.reduce((acc, curr) => {
            const g = curr.group || 'Geral';
            if (!acc[g]) acc[g] = [];
            acc[g].push(curr);
            return acc;
        }, {});

        // 2. Iterar sobre os grupos e criar seções
        Object.keys(grouped).sort().forEach(groupName => {
            const groupMembers = grouped[groupName];

            // Container do Grupo
            const section = document.createElement('div');
            section.className = 'w-full animate-in fade-in slide-in-from-bottom-4 duration-500';
            
            section.innerHTML = `
                <div class="flex items-center gap-4 mb-6">
                    <h3 class="text-2xl font-bold text-white capitalize">${groupName}</h3>
                    <div class="h-[1px] flex-1 bg-gradient-to-r from-[#333] to-transparent"></div>
                    <span class="text-xs font-mono text-gray-500 bg-[#1a1a1a] px-2 py-1 rounded border border-[#333]">${groupMembers.length}</span>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-8 justify-items-center group-grid">
                    </div>
            `;

            const grid = section.querySelector('.group-grid');
            
            // Criar cards para este grupo
            groupMembers.forEach(p => {
                grid.appendChild(createFarmCard(p));
            });

            elsFarm.container.appendChild(section);
        });
        
        lucide.createIcons();
    };

    // Card Específico para Fazenda (Similar ao Principal, mas tamanho uniforme e otimizado para grids maiores)
    const createFarmCard = (pokemon) => {
        const c1 = TYPE_COLORS[pokemon.type1] || '#333';
        const c2 = pokemon.type2 ? TYPE_COLORS[pokemon.type2] : c1;
        const gradientStyle = `linear-gradient(135deg, ${c1}, ${c2})`;

        const card = document.createElement('div');
        card.className = 'flex flex-col items-center group relative hover:-translate-y-2 transition-transform duration-300';
        
        card.innerHTML = `
            <div class="w-32 h-32 rounded-full p-[3px] shadow-lg relative z-10 bg-[#1a1a1a]" style="background: ${gradientStyle}">
                <div class="w-full h-full rounded-full border-[3px] border-[#1a1a1a] overflow-hidden bg-[#222] relative group-hover:brightness-110 transition">
                    ${generateAvatarHTML(pokemon.avatar, pokemon.name, "w-full h-full")}
                </div>
                
                <div class="absolute -right-1 bottom-1 flex flex-col gap-1">
                     <div class="w-3 h-3 rounded-full border border-[#1a1a1a]" style="background:${c1}" title="${pokemon.type1}"></div>
                     ${pokemon.type2 ? `<div class="w-3 h-3 rounded-full border border-[#1a1a1a]" style="background:${c2}" title="${pokemon.type2}"></div>` : ''}
                </div>
            </div>
            
            <div class="mt-3 text-center">
                <p class="font-bold text-gray-200 text-sm md:text-base leading-tight group-hover:text-white">${pokemon.name}</p>
                <p class="text-[10px] text-gray-500 uppercase tracking-wider mt-0.5">${pokemon.type1} ${pokemon.type2 ? '/ '+pokemon.type2 : ''}</p>
            </div>
        `;
        return card;
    };

    // --- VISUALIZADOR DIGIMON ---
    const elsDigi = {
        modal: document.getElementById('digimon-visualizer-modal'),
        title: document.getElementById('digi-viz-title'),
        container: document.getElementById('digimon-groups-container')
    };

    window.openDigimonVisualizer = (team) => {
        elsDigi.title.textContent = team.name;
        renderDigimonLayout(team.members || []);
        elsDigi.modal.classList.remove('hidden');
    };

    window.closeDigimonVisualizer = () => elsDigi.modal.classList.add('hidden');

    const renderDigimonLayout = (members) => {
        elsDigi.container.innerHTML = '';
        
        // Define a ordem fixa de exibição
        const order = ['Principal', 'Reserva', 'Box'];
        
        // Agrupa membros
        const grouped = { 'Principal': [], 'Reserva': [], 'Box': [] };
        members.forEach(m => {
            const g = m.group || 'Box'; // Fallback para Box
            if (grouped[g]) grouped[g].push(m);
            else grouped['Box'].push(m); // Segurança
        });

        // Renderiza na ordem definida
        order.forEach(groupName => {
            const groupMembers = grouped[groupName];
            if (groupMembers.length === 0) return; // Pula grupo vazio

            // Design do Header do Grupo
            const section = document.createElement('div');
            section.className = 'w-full animate-in fade-in slide-in-from-bottom-4 duration-500';
            
            // Cores do header dependendo do grupo
            let headerColor = 'text-blue-400 border-blue-900';
            if(groupName === 'Reserva') headerColor = 'text-yellow-500 border-yellow-900';
            if(groupName === 'Box') headerColor = 'text-gray-500 border-gray-800';

            section.innerHTML = `
                <div class="flex items-end gap-3 mb-4 border-b ${headerColor} pb-2">
                    <h3 class="text-2xl font-bold uppercase font-mono tracking-widest ${headerColor.split(' ')[0]}">${groupName}</h3>
                    <div class="text-xs bg-[#111] px-2 py-0.5 rounded border border-[#333] text-gray-400 mb-1">
                        MEM: ${String(groupMembers.length).padStart(2, '0')}
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    ${groupMembers.map(m => createDigimonCardHTML(m)).join('')}
                </div>
            `;
            
            elsDigi.container.appendChild(section);
        });
        
        lucide.createIcons();
    };

    // Função que retorna STRING HTML do card (mais fácil para grids complexos)
    const createDigimonCardHTML = (digimon) => {
        // Dados visuais
        const dType = DIGI_TYPES[digimon.digiType] || DIGI_TYPES['Free'];
        const dAttr = DIGI_ATTRS[digimon.digiAttr] || DIGI_ATTRS['Neutral'];

        // Fallback imagem
        const imgUrl = (digimon.avatar && digimon.avatar.length > 5) ? digimon.avatar : 'https://placehold.co/150x150/111/333?text=D';

        return `
        <div class="group relative bg-[#0f0f1a] border border-[#333] hover:border-[${dType.color}] rounded-xl overflow-hidden flex h-28 transition-all hover:-translate-y-1 hover:shadow-[0_4px_20px_-5px_rgba(0,0,0,0.7)] hover:shadow-[${dType.color}40]">
            
            <div class="w-1.5 h-full" style="background-color: ${dType.color}"></div>

            <div class="w-28 h-full shrink-0 relative overflow-hidden bg-black">
                <img src="${imgUrl}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity duration-300">
                <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-10 bg-[length:100%_2px,3px_100%] pointer-events-none"></div>
            </div>

            <div class="flex-1 flex flex-col justify-between p-3 relative z-10">
                
                <div class="w-full border-b border-white/10 pb-1 mb-1">
                    <h4 class="font-bold text-gray-100 truncate text-sm sm:text-base leading-tight font-mono">${digimon.name}</h4>
                </div>

                <div class="flex items-center gap-3 mt-auto">
                    
                    <div class="flex items-center gap-1.5 px-2 py-1 rounded bg-[#1a1a2e] border border-white/10 shadow-sm" title="Tipo: ${dType.label}">
                        <i data-lucide="${dType.icon}" class="w-3.5 h-3.5" style="color: ${dType.color}"></i>
                        <span class="text-[10px] font-bold uppercase tracking-wider text-gray-400 hidden sm:inline">${dType.label.substring(0,3)}</span>
                    </div>

                    <div class="flex items-center justify-center w-7 h-7 rounded-full bg-[#1a1a2e] border border-white/10 shadow-sm" title="Atributo: ${dAttr.label}">
                        <i data-lucide="${dAttr.icon}" class="w-4 h-4" style="color: ${dAttr.color}"></i>
                    </div>

                </div>

                <i data-lucide="${dType.icon}" class="absolute right-[-10px] bottom-[-15px] w-20 h-20 opacity-[0.03] text-white rotate-12 pointer-events-none"></i>
            </div>
        </div>
        `;
    };

    const openNewTeamModal = () => { editingId = null; els.form.reset(); els.btns.delete.classList.add('hidden'); els.modalTitle.textContent = "Novo Time"; els.modal.classList.remove('hidden'); els.modal.classList.add('flex'); };
    const openEditTeamModal = (data) => { editingId = data.id; els.inputs.name.value = data.name; els.inputs.game.value = data.game; els.inputs.img.value = data.img || ''; els.inputs.type.value = data.type || 'Geral'; els.btns.delete.classList.remove('hidden'); els.modalTitle.textContent = "Editar Time"; els.modal.classList.remove('hidden'); els.modal.classList.add('flex'); };
    const saveTeam = async (e) => { e.preventDefault(); const data = { name: els.inputs.name.value, game: els.inputs.game.value, img: els.inputs.img.value, type: els.inputs.type.value, updatedAt: new Date() }; try { if (editingId) await updateDoc(doc(db, 'users', currentUser.uid, 'teams_games', editingId), data); else { data.members = []; await addDoc(collection(db, 'users', currentUser.uid, 'teams_games'), data); } els.modal.classList.add('hidden'); } catch (err) { console.error(err); } };
    const deleteTeam = async () => { if(!editingId || !confirm("Tem certeza?")) return; await deleteDoc(doc(db, 'users', currentUser.uid, 'teams_games', editingId)); els.modal.classList.add('hidden'); };

    window.openMembersModal = (team) => { currentTeamData = team; currentTeamMembers = team.members || []; els.memberTeamName.textContent = team.name; renderMembersList(); els.memberEmptyState.classList.remove('hidden'); els.memberFormContainer.classList.add('hidden'); els.membersModal.classList.remove('hidden'); els.membersModal.classList.add('flex'); };
    window.closeMembersModal = () => els.membersModal.classList.add('hidden');
    
    const renderMembersList = () => {
        els.membersList.innerHTML = '';
        currentTeamMembers.forEach((member, index) => {
            const item = document.createElement('div');
            item.className = 'p-2 rounded-lg hover:bg-[#2a2a2a] cursor-pointer flex items-center gap-3 transition group border border-transparent hover:border-[#333]';
            
            let extraInfo = '';
            
            // Exibição condicional baseada no tipo
            if(currentTeamData.type === 'Futebol') {
                extraInfo = `<span class="text-[10px] text-gray-500 block">${member.posicao || '-'} #${member.numero || '?'} ${member.status === 'Reserva' ? '(R)' : ''}</span>`;
            } else {
                // Para Geral: Mostra a observação truncada
                const obsText = member.obs ? member.obs.substring(0, 30) + (member.obs.length > 30 ? '...' : '') : 'Membro';
                extraInfo = `<span class="text-[10px] text-gray-500 block">${obsText}</span>`;
            }

            item.innerHTML = `
                <div class="avatar-wrapper shrink-0">${generateAvatarHTML(member.avatar, member.name, "w-8 h-8")}</div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold text-gray-200 truncate">${member.name}</p>
                    ${extraInfo}
                </div>
                <i data-lucide="chevron-right" class="w-4 h-4 text-gray-600 group-hover:text-white"></i>
            `;
            item.onclick = () => loadMemberToForm(member, index);
            els.membersList.appendChild(item);
        });
        lucide.createIcons();
    };

    const renderTypeSpecificFields = (type, data = {}) => {
        const container = els.memberInputs.dynamic;
        container.innerHTML = '';

        // --- FUTEBOL ---
        if (type === 'Futebol') {
            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Posição</label>
                        <select id="mem-futebol-pos" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            <option value="Goleiro">Goleiro</option>
                            <option value="Zagueiro">Zagueiro</option>
                            <option value="Lateral">Lateral</option>
                            <option value="Volante">Volante</option>
                            <option value="Meia">Meia</option>
                            <option value="Atacante">Atacante</option>
                            <option value="Técnico">Técnico</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Número</label>
                        <input id="mem-futebol-num" type="number" class="w-full p-2.5 rounded-lg modal-input text-sm" placeholder="10">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Status</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="status" value="Titular" class="accent-[#B9314F]" checked> <span class="text-sm">Titular</span></label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="status" value="Reserva" class="accent-[#B9314F]"> <span class="text-sm">Reserva</span></label>
                    </div>
                </div>
            `;
            if(data.posicao) document.getElementById('mem-futebol-pos').value = data.posicao;
            if(data.numero) document.getElementById('mem-futebol-num').value = data.numero;
            if(data.status) {
                const radios = document.getElementsByName('status');
                radios.forEach(r => { if(r.value === data.status) r.checked = true; });
            }
        }
        else if (type === 'Pokemon Principal') {
            // Cria as opções do Select
            const typeOptions = POKE_TYPES.map(t => `<option value="${t}">${t}</option>`).join('');
            
            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tipo 1</label>
                        <select id="mem-poke-t1" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            ${typeOptions}
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tipo 2 (Opcional)</label>
                        <select id="mem-poke-t2" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            <option value="">Nenhum</option>
                            ${typeOptions}
                        </select>
                    </div>
                </div>
            `;
            // Preencher valores se editando
            if(data.type1) document.getElementById('mem-poke-t1').value = data.type1;
            if(data.type2) document.getElementById('mem-poke-t2').value = data.type2;
        }
        else if (type === 'Pokemon Fazenda') {
            const typeOptions = POKE_TYPES.map(t => `<option value="${t}">${t}</option>`).join('');
            
            // Define o HTML extra específico para Fazenda (Campo Grupo)
            let groupHtml = '';
            if (type === 'Pokemon Fazenda') {
                groupHtml = `
                    <div class="col-span-2 mt-3">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Grupo / Box</label>
                        <input id="mem-poke-group" type="text" list="existing-groups" class="w-full p-2.5 rounded-lg modal-input text-sm" placeholder="Ex: Fofos, Lendários, Shiny...">
                        <datalist id="existing-groups"></datalist> </div>
                `;
            }

            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tipo 1</label>
                        <select id="mem-poke-t1" class="w-full p-2.5 rounded-lg modal-input text-sm">${typeOptions}</select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tipo 2</label>
                        <select id="mem-poke-t2" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            <option value="">Nenhum</option>
                            ${typeOptions}
                        </select>
                    </div>
                    ${groupHtml}
                </div>
            `;
            
            if(data.type1) document.getElementById('mem-poke-t1').value = data.type1;
            if(data.type2) document.getElementById('mem-poke-t2').value = data.type2;
            if(type === 'Pokemon Fazenda' && data.group) document.getElementById('mem-poke-group').value = data.group;
        }
        else if (type === 'Digimon') {
            // Gerar Options dos Selects
            const typeOpts = Object.keys(DIGI_TYPES).map(k => `<option value="${k}">${DIGI_TYPES[k].label}</option>`).join('');
            const attrOpts = Object.keys(DIGI_ATTRS).map(k => `<option value="${k}">${DIGI_ATTRS[k].label}</option>`).join('');

            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Tipo</label>
                        <select id="mem-digi-type" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            ${typeOpts}
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Atributo</label>
                        <select id="mem-digi-attr" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            ${attrOpts}
                        </select>
                    </div>
                    <div class="col-span-2">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Grupo / Box</label>
                        <select id="mem-digi-group" class="w-full p-2.5 rounded-lg modal-input text-sm">
                            <option value="Principal">Principal (Party)</option>
                            <option value="Reserva">Reserva (Backup)</option>
                            <option value="Box">Box (Storage)</option>
                        </select>
                    </div>
                </div>
            `;
            
            if(data.digiType) document.getElementById('mem-digi-type').value = data.digiType;
            if(data.digiAttr) document.getElementById('mem-digi-attr').value = data.digiAttr;
            if(data.group) document.getElementById('mem-digi-group').value = data.group;
        }
        else {
            // Apenas campos básicos já existem no form principal, adicionamos a Observação aqui
            container.innerHTML = `
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Observação / Cargo</label>
                    <textarea id="mem-geral-obs" rows="3" class="w-full p-2.5 rounded-lg modal-input text-sm resize-none" placeholder="Ex: Líder do grupo, Suporte, etc...">${data.obs || ''}</textarea>
                </div>
            `;
        }
    };
    
    const getDynamicData = (type) => {
        if(type === 'Futebol') {
            return {
                posicao: document.getElementById('mem-futebol-pos').value,
                numero: document.getElementById('mem-futebol-num').value,
                status: document.querySelector('input[name="status"]:checked')?.value || 'Titular'
            };
        }

        if(type === 'Pokemon Principal') {
            return {
                type1: document.getElementById('mem-poke-t1').value,
                type2: document.getElementById('mem-poke-t2').value
            };
        }

        if (type === 'Pokemon Fazenda') {
            return {
                type1: document.getElementById('mem-poke-t1').value,
                type2: document.getElementById('mem-poke-t2').value,
                group: document.getElementById('mem-poke-group').value || 'Sem Grupo'
            };
        }

        if (type === 'Digimon') {
            return {
                digiType: document.getElementById('mem-digi-type').value,
                digiAttr: document.getElementById('mem-digi-attr').value,
                group: document.getElementById('mem-digi-group').value
            };
        }

        // Captura o campo de observação para 'Geral' e outros tipos padrão
        return { 
            obs: document.getElementById('mem-geral-obs') ? document.getElementById('mem-geral-obs').value : '' 
        };
    };

    window.prepareNewMember = () => { els.memberInputs.id.value = -1; els.memberInputs.name.value = ''; els.memberInputs.avatar.value = ''; renderTypeSpecificFields(currentTeamData.type); els.memberEmptyState.classList.add('hidden'); els.memberFormContainer.classList.remove('hidden'); els.btnDeleteMember.classList.add('hidden'); document.getElementById('member-form-title').textContent = "Novo Integrante"; };
    const loadMemberToForm = (member, index) => { els.memberInputs.id.value = index; els.memberInputs.name.value = member.name; els.memberInputs.avatar.value = member.avatar || ''; renderTypeSpecificFields(currentTeamData.type, member); els.memberEmptyState.classList.add('hidden'); els.memberFormContainer.classList.remove('hidden'); els.btnDeleteMember.classList.remove('hidden'); document.getElementById('member-form-title').textContent = "Editar Integrante"; };
    const saveMember = async (e) => { e.preventDefault(); const index = parseInt(els.memberInputs.id.value); const memberData = { name: els.memberInputs.name.value, avatar: els.memberInputs.avatar.value, ...getDynamicData(currentTeamData.type) }; const updatedMembers = [...currentTeamMembers]; if(index === -1) updatedMembers.push(memberData); else updatedMembers[index] = memberData; try { await updateDoc(doc(db, 'users', currentUser.uid, 'teams_games', currentTeamData.id), { members: updatedMembers }); currentTeamMembers = updatedMembers; renderMembersList(); render(); els.memberFormContainer.classList.add('hidden'); els.memberEmptyState.classList.remove('hidden'); } catch (err) { console.error(err); alert("Erro ao salvar."); } };
    const deleteMember = async () => { const index = parseInt(els.memberInputs.id.value); if(index === -1 || !confirm("Remover este integrante?")) return; const updatedMembers = currentTeamMembers.filter((_, i) => i !== index); try { await updateDoc(doc(db, 'users', currentUser.uid, 'teams_games', currentTeamData.id), { members: updatedMembers }); currentTeamMembers = updatedMembers; renderMembersList(); render(); els.memberFormContainer.classList.add('hidden'); els.memberEmptyState.classList.remove('hidden'); } catch (err) { console.error(err); } };

    const init = () => { els.btns.add.onclick = openNewTeamModal; els.btns.close.onclick = () => els.modal.classList.add('hidden'); els.form.onsubmit = saveTeam; els.btns.delete.onclick = deleteTeam; els.memberForm.onsubmit = saveMember; els.btnDeleteMember.onclick = deleteMember; els.btns.logout.onclick = () => signOut(auth); els.search.oninput = render; els.filterType.onchange = render; els.inputs.game.addEventListener('input', (e) => { const gameObj = allGames.find(g => g.name === e.target.value); if (gameObj && gameObj.image) els.inputs.img.value = gameObj.image; }); };
    onAuthStateChanged(auth, async (user) => { if (!user) return window.location.href = 'index.html'; currentUser = user; document.getElementById('user-display').textContent = user.email; try { const gamesSnap = await getDocs(collection(db, 'users', user.uid, 'games')); allGames = []; els.datalist.innerHTML = ''; gamesSnap.forEach(doc => { const g = doc.data(); if(g.name) { allGames.push({ name: g.name, image: g.image }); const opt = document.createElement('option'); opt.value = g.name; els.datalist.appendChild(opt); } }); const q = query(collection(db, 'users', user.uid, 'teams_games')); onSnapshot(q, (snap) => { allTeams = []; snap.forEach(doc => allTeams.push({ id: doc.id, ...doc.data() })); allTeams.sort((a,b) => a.name.localeCompare(b.name)); render(); toggleLoading(false); }); } catch (err) { console.error(err); } });
    init();
  </script>
</body>
</html>
