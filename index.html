<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub de Acesso - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .btn-primary {
            background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            opacity: 0.9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <div id="auth-container" class="w-full max-w-sm mx-4 p-8 bg-white rounded-xl shadow-2xl border border-gray-100 transition-all duration-300">
        
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Aceder ao Hub</h1>

        <!-- Área de Mensagens (Erros/Sucesso) -->
        <div id="message-box" class="hidden p-3 mb-4 rounded-lg text-sm transition-all duration-300"></div>

        <!-- Formulário de Login/Registo -->
        <div id="login-form">
            <input type="email" id="email" placeholder="Email" class="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" required>
            <input type="password" id="password" placeholder="Senha (mín. 6 caracteres)" class="w-full p-3 mb-6 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" required>
            
            <button id="loginBtn" class="btn-primary w-full text-white font-semibold py-3 rounded-lg mb-3 shadow-md">
                Entrar
            </button>
            <button id="registerBtn" class="w-full bg-gray-200 text-gray-700 font-semibold py-3 rounded-lg hover:bg-gray-300 transition duration-150">
                Registar
            </button>
        </div>
    </div>

    <!-- Script de Firebase e Lógica de Autenticação -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Configuração do Firebase (Fixa)
        const firebaseConfig = {
            apiKey: "AIzaSyDsbiLPBOda119Qr6Ji69j8TZLpiFixBWI",
            authDomain: "list-games-9bddd.firebaseapp.com",
            projectId: "list-games-9bddd",
            storageBucket: "list-games-9bddd.firebasestorage.app",
            messagingSenderId: "756898313156",
            appId: "1:756898313156:web:9bc660d0a2f4cd07882a91",
            measurementId: "G-GLM50YVLXP"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const messageBox = document.getElementById('message-box');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');

        function showMessage(message, isError) {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            
            if (isError) {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                messageBox.classList.add('bg-green-100', 'text-green-700');
            }
            
            setTimeout(() => messageBox.classList.add('hidden'), 5000);
        }

        function mapError(code) {
            switch (code) {
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                    return 'Credenciais inválidas. Verifique o email e a senha.';
                case 'auth/email-already-in-use':
                    return 'O email fornecido já está em uso por outra conta.';
                case 'auth/weak-password':
                    return 'A senha deve ter pelo menos 6 caracteres.';
                case 'auth/invalid-email':
                    return 'O formato do email é inválido.';
                default:
                    return 'Ocorreu um erro inesperado. Tente novamente.';
            }
        }

        /**
         * Redireciona o utilizador para a página principal se estiver autenticado.
         */
        function updateUI(user) {
            if (user) {
                // REDIRECIONA para a página principal se estiver logado
                window.location.href = 'home.html';
            }
            // Se não estiver logado, permanece no formulário
        }

        onAuthStateChanged(auth, (user) => {
            updateUI(user);
        });

        async function handleRegister() {
            const email = emailInput.value;
            const password = passwordInput.value;

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showMessage('Registo bem-sucedido! Redirecionando...', false);
            } catch (error) {
                showMessage(mapError(error.code), true);
            }
        }

        async function handleLogin() {
            const email = emailInput.value;
            const password = passwordInput.value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                showMessage('Login bem-sucedido! Redirecionando...', false);
            } catch (error) {
                showMessage(mapError(error.code), true);
            }
        }

        document.getElementById('loginBtn').addEventListener('click', handleLogin);
        document.getElementById('registerBtn').addEventListener('click', handleRegister);
    </script>
</body>
</html>
